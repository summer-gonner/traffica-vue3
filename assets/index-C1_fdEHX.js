import{f as u}from"./dateUtil-E1W9AnjJ.js";import{T as x}from"./index-Qnpm0yEw.js";import{c as f,d as C,n as T,B as k,E as c,G as S,F as h,aY as s,A as g}from"./index-B8Pm80oX.js";import{u as P}from"./dynamic-table-D22kRkZE.js";import"./ApiSelect.vue_vue_type_script_setup_true_lang-CofY2-NC.js";import"./dayjs.min-TeQhONF1.js";import"./index.vue_vue_type_style_index_0_lang-CFuk3e67.js";import{u as v}from"./useFormModal-CmrBxBAu.js";import"./index-CWarxRuf.js";import"./index-CND5kIK4.js";import"./_baseUniq-kMXtQ-ld.js";import"./_arrayIncludesWith-DbV0gfeD.js";import"./collapseMotion-Dg6yIgr5.js";import"./move-B3QdINpa.js";import"./RightOutlined-BsZy0Phy.js";import"./VerticalRightOutlined-C0b_NAnm.js";import"./cloneDeep-lQkziu_-.js";import"./schema-form.vue_vue_type_script_setup_true_lang-CqVOkWCm.js";import"./isNumber-BQFvOqOr.js";import"./is-BPG7p_4t.js";import"./index-BT78Vb1q.js";import"./useFlexGapSupport-DLL49fC4.js";import"./hasIn-D18GTBYl.js";import"./debounce-TsE9rPWj.js";import"./QuestionCircleOutlined-DwMKnzgY.js";import"./_castArrayLikeObject-DUjGHYOU.js";import"./index-7VmM7i5b.js";import"./DownOutlined-BRycSuUV.js";import"./index-CIQauGJF.js";import"./pick-yPjmipd3.js";import"./FullscreenOutlined-BZ3QrFwa.js";import"./index-CfT4fuvs.js";import"./LeftOutlined-BKTs5glU.js";import"./zh_CN-CAyhejr6.js";import"./index-iNKLbYy_.js";import"./useMergedState-Cz6_zboM.js";import"./index-B7GNZFXE.js";import"./EnterOutlined-BnZ699CI.js";import"./CheckOutlined-D9pyqrzu.js";import"./CopyOutlined-D95pQ5l8.js";import"./index-g76Nm4Kx.js";import"./isMobile-BbN7I0i_.js";import"./useRefs-QkKGnXKa.js";import"./index-DhL-eOiI.js";import"./index-BRG9fhiq.js";import"./index-B4w1aCCw.js";import"./useModal-ClPC9oek.js";const E=[{title:"#",dataIndex:"id",width:55,hideInSearch:!0},{title:"ES名称",width:200,dataIndex:"name"},{title:"ES地址",width:180,dataIndex:"address"},{title:"连接结果",dataIndex:"result",width:80,formItemProps:{component:"Select",componentProps:{options:[{label:"成功",value:"Y"},{label:"失败",value:"N"}]}},customRender:({record:o})=>{const m=o.result==="Y";return f(x,{color:m?"green":"red"},{default:()=>[m?"成功":"失败"]})}},{title:"备注",dataIndex:"remark"},{title:"创建时间",dataIndex:"createTime",hideInSearch:!0,customRender:({record:o})=>o.createTime===""?"":u(o.createTime)},{title:"更新时间",dataIndex:"updateTime",hideInSearch:!0,customRender:({record:o})=>o.updateTime===""?"":u(o.updateTime)}],R=[{field:"name",component:"Input",label:"角色名称",rules:[{required:!0,type:"string"}],colProps:{span:12}},{field:"value",component:"Input",label:"角色值",rules:[{required:!0,type:"string"}],colProps:{span:12}},{field:"status",label:"状态",component:"RadioGroup",defaultValue:1,componentProps:{options:[{label:"启用",value:1},{label:"停用",value:0}]}},{field:"remark",component:"InputTextArea",label:"备注"},{field:"menuIds",component:"Tree",label:"菜单权限",componentProps:{checkable:!0,vModelKey:"checkedKeys",fieldNames:{title:"name",key:"id"},style:{height:"350px",paddingTop:"5px",overflow:"auto",borderRadius:"6px",border:"1px solid #dcdfe6",resize:"vertical"}}}],ke=C({name:"SystemPermissionRole",__name:"index",setup(o){const[m,n]=P(),[b]=v(),p=(e,t,a=[])=>t.reduce((i,r)=>{var l;return(l=r.children)!=null&&l.length?p(e,r.children,a):e.includes(r.id)&&i.push(r.id),i},a),d=async e=>{const[t]=await b({modalProps:{title:`${e.id?"编辑":"新增"}ES`,width:"50%",onFinish:async i=>{e.id&&(i.roleId=e.id);const r=t==null?void 0:t.compRefMap.get("menuIds"),l={...i,menuIds:[...r.halfCheckedKeys,...r.checkedKeys]};console.log("新增/编辑ES",l),e.id?await s.systemRole.roleUpdate({id:e.id},l):await s.systemRole.roleCreate(l),n==null||n.reload()}},formProps:{labelWidth:100,schemas:R}}),a=await s.systemMenu.menuList({});if(t==null||t.updateSchema([{field:"menuIds",componentProps:{treeData:a}}]),e.id){const i=await s.systemRole.roleInfo({id:e.id});t==null||t.setFieldsValue({...e,menuIds:p(i.menuIds,a)})}},y=async e=>{e.id&&await s.recordEs.esConnect({id:e.id})},I=async e=>{await s.systemRole.roleDelete({id:e.id}),n==null||n.reload()},w=[...E,{title:"操作",width:300,dataIndex:"ACTION",hideInSearch:!0,fixed:"right",actions:({record:e})=>[{label:"编辑",auth:{perm:"system:role:update",effect:"disable"},onClick:()=>{d(e)}},{label:"删除",auth:"system:role:delete",popConfirm:{title:"你确定要删除吗？",placement:"left",onConfirm:()=>I(e)}},{label:"测试连接",onClick:()=>{y(e)}}]}];return(e,t)=>{const a=g("a-button");return T(),k(h(m),{"row-key":"id","header-title":"ES管理","title-tooltip":"超级管理员默认拥有所有资源访问权限且不支持修改","data-request":h(s).recordEs.esList,columns:w,bordered:"",size:"small"},{toolbar:c(()=>[f(a,{type:"primary",disabled:!e.$auth("system:role:create"),onClick:t[0]||(t[0]=i=>d({}))},{default:c(()=>t[1]||(t[1]=[S(" 新增 ")])),_:1},8,["disabled"])]),_:1},8,["data-request"])}}});export{ke as default};
