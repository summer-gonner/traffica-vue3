import{cX as be,d as we,r as A,b as _e,n as xe,q as Ce,c as $,E as J,F as W,y as K,G as ke,aY as Se,aq as Ae,cI as Ie,ef as ne,a3 as Ue,dr as Fe,aX as Oe}from"./index-B8Pm80oX.js";import{_ as ze}from"./index-DhL-eOiI.js";import{D as Ee}from"./index-P37OXH9W.js";var fe=function(){var r=function(n,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var t in o)o.hasOwnProperty(t)&&(i[t]=o[t])},r(n,e)};return function(n,e){r(n,e);function i(){this.constructor=n}n.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),b;(function(r){r.InvalidFile="InvalidFile",r.InvalidToken="InvalidToken",r.InvalidMetadata="InvalidMetadata",r.InvalidChunkSize="InvalidChunkSize",r.InvalidCustomVars="InvalidCustomVars",r.NotAvailableUploadHost="NotAvailableUploadHost",r.ReadCacheFailed="ReadCacheFailed",r.InvalidCacheData="InvalidCacheData",r.WriteCacheFailed="WriteCacheFailed",r.RemoveCacheFailed="RemoveCacheFailed",r.GetCanvasContextFailed="GetCanvasContextFailed",r.UnsupportedFileType="UnsupportedFileType",r.FileReaderReadFailed="FileReaderReadFailed",r.NotAvailableXMLHttpRequest="NotAvailableXMLHttpRequest",r.InvalidProgressEventTarget="InvalidProgressEventTarget",r.RequestError="RequestError"})(b||(b={}));var _=function(){function r(n,e){this.name=n,this.message=e,this.stack=new Error().stack}return r}(),M=function(r){fe(n,r);function n(e,i,o,t){var l=r.call(this,b.RequestError,o)||this;return l.code=e,l.reqId=i,l.isRequestError=!0,l.data=t,l}return n}(_),Re=function(r){fe(n,r);function n(e,i){return i===void 0&&(i=""),r.call(this,0,i,e)||this}return n}(M),Pe=function(){function r(n,e){this.runTask=n,this.limit=e,this.aborted=!1,this.queue=[],this.processing=[]}return r.prototype.enqueue=function(n){var e=this;return new Promise(function(i,o){e.queue.push({task:n,resolve:i,reject:o}),e.check()})},r.prototype.run=function(n){var e=this;this.queue=this.queue.filter(function(i){return i!==n}),this.processing.push(n),this.runTask(n.task).then(function(){e.processing=e.processing.filter(function(i){return i!==n}),n.resolve(),e.check()},function(i){return n.reject(i)})},r.prototype.check=function(){var n=this;if(!this.aborted){var e=this.processing.length,i=this.limit-e;this.queue.slice(0,i).forEach(function(o){n.run(o)})}},r.prototype.abort=function(){this.queue=[],this.aborted=!0},r}(),Le=function(){var r=function(n,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var t in o)o.hasOwnProperty(t)&&(i[t]=o[t])},r(n,e)};return function(n,e){r(n,e);function i(){this.constructor=n}n.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),q=function(){return q=Object.assign||function(r){for(var n,e=1,i=arguments.length;e<i;e++){n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])}return r},q.apply(this,arguments)},Te=function(){function r(){this.closed=!1}return r.prototype.unsubscribe=function(){this.closed||(this.closed=!0,this._unsubscribe&&this._unsubscribe())},r.prototype.add=function(n){this._unsubscribe=n},r}(),De=function(r){Le(n,r);function n(e,i,o){var t=r.call(this)||this;return t.isStopped=!1,e&&typeof e=="object"?t.destination=e:t.destination=q(q(q({},e&&{next:e}),i&&{error:i}),o&&{complete:o}),t}return n.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,r.prototype.unsubscribe.call(this))},n.prototype.next=function(e){!this.isStopped&&this.destination.next&&this.destination.next(e)},n.prototype.error=function(e){!this.isStopped&&this.destination.error&&(this.isStopped=!0,this.destination.error(e))},n.prototype.complete=function(e){!this.isStopped&&this.destination.complete&&(this.isStopped=!0,this.destination.complete(e))},n}(Te),He=function(){function r(n){this._subscribe=n}return r.prototype.subscribe=function(n,e,i){var o=new De(n,e,i);return o.add(this._subscribe(o)),o},r}();function qe(r){if(r===null||typeof r>"u")return"";var n=r+"",e="",i,o,t=0;i=o=0,t=n.length;for(var l=0;l<t;l++){var p=n.charCodeAt(l),y=null;if(p<128)o++;else if(p>127&&p<2048)y=String.fromCharCode(p>>6|192,p&63|128);else if((p&63488^55296)>0)y=String.fromCharCode(p>>12|224,p>>6&63|128,p&63|128);else{if((p&64512^55296)>0)throw new RangeError("Unmatched trail surrogate at "+l);var a=n.charCodeAt(++l);if((a&64512^56320)>0)throw new RangeError("Unmatched lead surrogate at "+(l-1));p=((p&1023)<<10)+(a&1023)+65536,y=String.fromCharCode(p>>18|240,p>>12&63|128,p>>6&63|128,p&63|128)}y!==null&&(o>i&&(e+=n.slice(i,o)),e+=y,i=o=l+1)}return o>i&&(e+=n.slice(i,t)),e}function Be(r){var n=[],e=0,i=0,o=0;for(r+="";e<r.length;){i=r.charCodeAt(e)&255,o=0,i<=191?(i=i&127,o=1):i<=223?(i=i&31,o=2):i<=239?(i=i&15,o=3):(i=i&7,o=4);for(var t=1;t<o;++t)i=i<<6|r.charCodeAt(t+e)&63;o===4?(i-=65536,n.push(String.fromCharCode(55296|i>>10&1023)),n.push(String.fromCharCode(56320|i&1023))):n.push(String.fromCharCode(i)),e+=o}return n.join("")}function Me(r){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e,i,o,t,l,p,y,a,h=0,v=0,x="",C=[];if(!r)return r;r=qe(r+"");do e=r.charCodeAt(h++),i=r.charCodeAt(h++),o=r.charCodeAt(h++),a=e<<16|i<<8|o,t=a>>18&63,l=a>>12&63,p=a>>6&63,y=a&63,C[v++]=n.charAt(t)+n.charAt(l)+n.charAt(p)+n.charAt(y);while(h<r.length);switch(x=C.join(""),r.length%3){case 1:x=x.slice(0,-2)+"==";break;case 2:x=x.slice(0,-1)+"=";break}return x}function je(r){var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e,i,o,t,l,p,y,a,h=0,v=0,x="",C=[];if(!r)return r;r+="";do t=n.indexOf(r.charAt(h++)),l=n.indexOf(r.charAt(h++)),p=n.indexOf(r.charAt(h++)),y=n.indexOf(r.charAt(h++)),a=t<<18|l<<12|p<<6|y,e=a>>16&255,i=a>>8&255,o=a&255,p===64?C[v++]=String.fromCharCode(e):y===64?C[v++]=String.fromCharCode(e,i):C[v++]=String.fromCharCode(e,i,o);while(h<r.length);return x=C.join(""),Be(x)}function le(r){return r=Me(r),r.replace(/\//g,"_").replace(/\+/g,"-")}function $e(r){return r=r.replace(/_/g,"/").replace(/-/g,"+"),je(r)}var he={exports:{}};(function(r,n){(function(e){r.exports=e()})(function(e){var i=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function o(g,d){var u=g[0],s=g[1],f=g[2],c=g[3];u+=(s&f|~s&c)+d[0]-680876936|0,u=(u<<7|u>>>25)+s|0,c+=(u&s|~u&f)+d[1]-389564586|0,c=(c<<12|c>>>20)+u|0,f+=(c&u|~c&s)+d[2]+606105819|0,f=(f<<17|f>>>15)+c|0,s+=(f&c|~f&u)+d[3]-1044525330|0,s=(s<<22|s>>>10)+f|0,u+=(s&f|~s&c)+d[4]-176418897|0,u=(u<<7|u>>>25)+s|0,c+=(u&s|~u&f)+d[5]+1200080426|0,c=(c<<12|c>>>20)+u|0,f+=(c&u|~c&s)+d[6]-1473231341|0,f=(f<<17|f>>>15)+c|0,s+=(f&c|~f&u)+d[7]-45705983|0,s=(s<<22|s>>>10)+f|0,u+=(s&f|~s&c)+d[8]+1770035416|0,u=(u<<7|u>>>25)+s|0,c+=(u&s|~u&f)+d[9]-1958414417|0,c=(c<<12|c>>>20)+u|0,f+=(c&u|~c&s)+d[10]-42063|0,f=(f<<17|f>>>15)+c|0,s+=(f&c|~f&u)+d[11]-1990404162|0,s=(s<<22|s>>>10)+f|0,u+=(s&f|~s&c)+d[12]+1804603682|0,u=(u<<7|u>>>25)+s|0,c+=(u&s|~u&f)+d[13]-40341101|0,c=(c<<12|c>>>20)+u|0,f+=(c&u|~c&s)+d[14]-1502002290|0,f=(f<<17|f>>>15)+c|0,s+=(f&c|~f&u)+d[15]+1236535329|0,s=(s<<22|s>>>10)+f|0,u+=(s&c|f&~c)+d[1]-165796510|0,u=(u<<5|u>>>27)+s|0,c+=(u&f|s&~f)+d[6]-1069501632|0,c=(c<<9|c>>>23)+u|0,f+=(c&s|u&~s)+d[11]+643717713|0,f=(f<<14|f>>>18)+c|0,s+=(f&u|c&~u)+d[0]-373897302|0,s=(s<<20|s>>>12)+f|0,u+=(s&c|f&~c)+d[5]-701558691|0,u=(u<<5|u>>>27)+s|0,c+=(u&f|s&~f)+d[10]+38016083|0,c=(c<<9|c>>>23)+u|0,f+=(c&s|u&~s)+d[15]-660478335|0,f=(f<<14|f>>>18)+c|0,s+=(f&u|c&~u)+d[4]-405537848|0,s=(s<<20|s>>>12)+f|0,u+=(s&c|f&~c)+d[9]+568446438|0,u=(u<<5|u>>>27)+s|0,c+=(u&f|s&~f)+d[14]-1019803690|0,c=(c<<9|c>>>23)+u|0,f+=(c&s|u&~s)+d[3]-187363961|0,f=(f<<14|f>>>18)+c|0,s+=(f&u|c&~u)+d[8]+1163531501|0,s=(s<<20|s>>>12)+f|0,u+=(s&c|f&~c)+d[13]-1444681467|0,u=(u<<5|u>>>27)+s|0,c+=(u&f|s&~f)+d[2]-51403784|0,c=(c<<9|c>>>23)+u|0,f+=(c&s|u&~s)+d[7]+1735328473|0,f=(f<<14|f>>>18)+c|0,s+=(f&u|c&~u)+d[12]-1926607734|0,s=(s<<20|s>>>12)+f|0,u+=(s^f^c)+d[5]-378558|0,u=(u<<4|u>>>28)+s|0,c+=(u^s^f)+d[8]-2022574463|0,c=(c<<11|c>>>21)+u|0,f+=(c^u^s)+d[11]+1839030562|0,f=(f<<16|f>>>16)+c|0,s+=(f^c^u)+d[14]-35309556|0,s=(s<<23|s>>>9)+f|0,u+=(s^f^c)+d[1]-1530992060|0,u=(u<<4|u>>>28)+s|0,c+=(u^s^f)+d[4]+1272893353|0,c=(c<<11|c>>>21)+u|0,f+=(c^u^s)+d[7]-155497632|0,f=(f<<16|f>>>16)+c|0,s+=(f^c^u)+d[10]-1094730640|0,s=(s<<23|s>>>9)+f|0,u+=(s^f^c)+d[13]+681279174|0,u=(u<<4|u>>>28)+s|0,c+=(u^s^f)+d[0]-358537222|0,c=(c<<11|c>>>21)+u|0,f+=(c^u^s)+d[3]-722521979|0,f=(f<<16|f>>>16)+c|0,s+=(f^c^u)+d[6]+76029189|0,s=(s<<23|s>>>9)+f|0,u+=(s^f^c)+d[9]-640364487|0,u=(u<<4|u>>>28)+s|0,c+=(u^s^f)+d[12]-421815835|0,c=(c<<11|c>>>21)+u|0,f+=(c^u^s)+d[15]+530742520|0,f=(f<<16|f>>>16)+c|0,s+=(f^c^u)+d[2]-995338651|0,s=(s<<23|s>>>9)+f|0,u+=(f^(s|~c))+d[0]-198630844|0,u=(u<<6|u>>>26)+s|0,c+=(s^(u|~f))+d[7]+1126891415|0,c=(c<<10|c>>>22)+u|0,f+=(u^(c|~s))+d[14]-1416354905|0,f=(f<<15|f>>>17)+c|0,s+=(c^(f|~u))+d[5]-57434055|0,s=(s<<21|s>>>11)+f|0,u+=(f^(s|~c))+d[12]+1700485571|0,u=(u<<6|u>>>26)+s|0,c+=(s^(u|~f))+d[3]-1894986606|0,c=(c<<10|c>>>22)+u|0,f+=(u^(c|~s))+d[10]-1051523|0,f=(f<<15|f>>>17)+c|0,s+=(c^(f|~u))+d[1]-2054922799|0,s=(s<<21|s>>>11)+f|0,u+=(f^(s|~c))+d[8]+1873313359|0,u=(u<<6|u>>>26)+s|0,c+=(s^(u|~f))+d[15]-30611744|0,c=(c<<10|c>>>22)+u|0,f+=(u^(c|~s))+d[6]-1560198380|0,f=(f<<15|f>>>17)+c|0,s+=(c^(f|~u))+d[13]+1309151649|0,s=(s<<21|s>>>11)+f|0,u+=(f^(s|~c))+d[4]-145523070|0,u=(u<<6|u>>>26)+s|0,c+=(s^(u|~f))+d[11]-1120210379|0,c=(c<<10|c>>>22)+u|0,f+=(u^(c|~s))+d[2]+718787259|0,f=(f<<15|f>>>17)+c|0,s+=(c^(f|~u))+d[9]-343485551|0,s=(s<<21|s>>>11)+f|0,g[0]=u+g[0]|0,g[1]=s+g[1]|0,g[2]=f+g[2]|0,g[3]=c+g[3]|0}function t(g){var d=[],u;for(u=0;u<64;u+=4)d[u>>2]=g.charCodeAt(u)+(g.charCodeAt(u+1)<<8)+(g.charCodeAt(u+2)<<16)+(g.charCodeAt(u+3)<<24);return d}function l(g){var d=[],u;for(u=0;u<64;u+=4)d[u>>2]=g[u]+(g[u+1]<<8)+(g[u+2]<<16)+(g[u+3]<<24);return d}function p(g){var d=g.length,u=[1732584193,-271733879,-1732584194,271733878],s,f,c,w,k,S;for(s=64;s<=d;s+=64)o(u,t(g.substring(s-64,s)));for(g=g.substring(s-64),f=g.length,c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s=0;s<f;s+=1)c[s>>2]|=g.charCodeAt(s)<<(s%4<<3);if(c[s>>2]|=128<<(s%4<<3),s>55)for(o(u,c),s=0;s<16;s+=1)c[s]=0;return w=d*8,w=w.toString(16).match(/(.*?)(.{0,8})$/),k=parseInt(w[2],16),S=parseInt(w[1],16)||0,c[14]=k,c[15]=S,o(u,c),u}function y(g){var d=g.length,u=[1732584193,-271733879,-1732584194,271733878],s,f,c,w,k,S;for(s=64;s<=d;s+=64)o(u,l(g.subarray(s-64,s)));for(g=s-64<d?g.subarray(s-64):new Uint8Array(0),f=g.length,c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s=0;s<f;s+=1)c[s>>2]|=g[s]<<(s%4<<3);if(c[s>>2]|=128<<(s%4<<3),s>55)for(o(u,c),s=0;s<16;s+=1)c[s]=0;return w=d*8,w=w.toString(16).match(/(.*?)(.{0,8})$/),k=parseInt(w[2],16),S=parseInt(w[1],16)||0,c[14]=k,c[15]=S,o(u,c),u}function a(g){var d="",u;for(u=0;u<4;u+=1)d+=i[g>>u*8+4&15]+i[g>>u*8&15];return d}function h(g){var d;for(d=0;d<g.length;d+=1)g[d]=a(g[d]);return g.join("")}h(p("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function g(d,u){return d=d|0||0,d<0?Math.max(d+u,0):Math.min(d,u)}ArrayBuffer.prototype.slice=function(d,u){var s=this.byteLength,f=g(d,s),c=s,w,k,S,L;return u!==e&&(c=g(u,s)),f>c?new ArrayBuffer(0):(w=c-f,k=new ArrayBuffer(w),S=new Uint8Array(k),L=new Uint8Array(this,f,w),S.set(L),k)}}();function v(g){return/[\u0080-\uFFFF]/.test(g)&&(g=unescape(encodeURIComponent(g))),g}function x(g,d){var u=g.length,s=new ArrayBuffer(u),f=new Uint8Array(s),c;for(c=0;c<u;c+=1)f[c]=g.charCodeAt(c);return d?f:s}function C(g){return String.fromCharCode.apply(null,new Uint8Array(g))}function U(g,d,u){var s=new Uint8Array(g.byteLength+d.byteLength);return s.set(new Uint8Array(g)),s.set(new Uint8Array(d),g.byteLength),s}function F(g){var d=[],u=g.length,s;for(s=0;s<u-1;s+=2)d.push(parseInt(g.substr(s,2),16));return String.fromCharCode.apply(String,d)}function m(){this.reset()}return m.prototype.append=function(g){return this.appendBinary(v(g)),this},m.prototype.appendBinary=function(g){this._buff+=g,this._length+=g.length;var d=this._buff.length,u;for(u=64;u<=d;u+=64)o(this._hash,t(this._buff.substring(u-64,u)));return this._buff=this._buff.substring(u-64),this},m.prototype.end=function(g){var d=this._buff,u=d.length,s,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],c;for(s=0;s<u;s+=1)f[s>>2]|=d.charCodeAt(s)<<(s%4<<3);return this._finish(f,u),c=h(this._hash),g&&(c=F(c)),this.reset(),c},m.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},m.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},m.prototype.setState=function(g){return this._buff=g.buff,this._length=g.length,this._hash=g.hash,this},m.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},m.prototype._finish=function(g,d){var u=d,s,f,c;if(g[u>>2]|=128<<(u%4<<3),u>55)for(o(this._hash,g),u=0;u<16;u+=1)g[u]=0;s=this._length*8,s=s.toString(16).match(/(.*?)(.{0,8})$/),f=parseInt(s[2],16),c=parseInt(s[1],16)||0,g[14]=f,g[15]=c,o(this._hash,g)},m.hash=function(g,d){return m.hashBinary(v(g),d)},m.hashBinary=function(g,d){var u=p(g),s=h(u);return d?F(s):s},m.ArrayBuffer=function(){this.reset()},m.ArrayBuffer.prototype.append=function(g){var d=U(this._buff.buffer,g),u=d.length,s;for(this._length+=g.byteLength,s=64;s<=u;s+=64)o(this._hash,l(d.subarray(s-64,s)));return this._buff=s-64<u?new Uint8Array(d.buffer.slice(s-64)):new Uint8Array(0),this},m.ArrayBuffer.prototype.end=function(g){var d=this._buff,u=d.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],f,c;for(f=0;f<u;f+=1)s[f>>2]|=d[f]<<(f%4<<3);return this._finish(s,u),c=h(this._hash),g&&(c=F(c)),this.reset(),c},m.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},m.ArrayBuffer.prototype.getState=function(){var g=m.prototype.getState.call(this);return g.buff=C(g.buff),g},m.ArrayBuffer.prototype.setState=function(g){return g.buff=x(g.buff,!0),m.prototype.setState.call(this,g)},m.ArrayBuffer.prototype.destroy=m.prototype.destroy,m.ArrayBuffer.prototype._finish=m.prototype._finish,m.ArrayBuffer.hash=function(g,d){var u=y(new Uint8Array(g)),s=h(u);return d?F(s):s},m})})(he);var Ve=he.exports;const Ge=be(Ve);var G=function(){return G=Object.assign||function(r){for(var n,e=1,i=arguments.length;e<i;e++){n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])}return r},G.apply(this,arguments)},Ne=function(r,n,e,i){function o(t){return t instanceof e?t:new e(function(l){l(t)})}return new(e||(e=Promise))(function(t,l){function p(h){try{a(i.next(h))}catch(v){l(v)}}function y(h){try{a(i.throw(h))}catch(v){l(v)}}function a(h){h.done?t(h.value):o(h.value).then(p,y)}a((i=i.apply(r,n||[])).next())})},Xe=function(r,n){var e={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},i,o,t,l;return l={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function p(a){return function(h){return y([a,h])}}function y(a){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,o&&(t=a[0]&2?o.return:a[0]?o.throw||((t=o.return)&&t.call(o),0):o.next)&&!(t=t.call(o,a[1])).done)return t;switch(o=0,t&&(a=[a[0]&2,t.value]),a[0]){case 0:case 1:t=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,o=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(t=e.trys,!(t=t.length>0&&t[t.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!t||a[1]>t[0]&&a[1]<t[3])){e.label=a[1];break}if(a[0]===6&&e.label<t[1]){e.label=t[1],t=a;break}if(t&&e.label<t[2]){e.label=t[2],e.ops.push(a);break}t[2]&&e.ops.pop(),e.trys.pop();continue}a=n.call(r,e)}catch(h){a=[6,h],o=0}finally{i=t=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},R=Math.pow(1024,2);function Je(r,n){var e=n*R;if(e>r.size)e=r.size;else for(;r.size>e*1e4;)e*=2;for(var i=[],o=Math.ceil(r.size/e),t=0;t<o;t++){var l=r.slice(e*t,t===o-1?r.size:e*(t+1));i.push(l)}return i}function We(r){return Object.keys(r).every(function(n){return n.indexOf("x-qn-meta-")===0})}function Ke(r){return Object.keys(r).every(function(n){return n.indexOf("x:")===0})}function Ye(r){return r.reduce(function(n,e){return n+e},0)}function Ze(r,n,e){try{localStorage.setItem(r,JSON.stringify(n))}catch{e.warn(new _(b.WriteCacheFailed,"setLocalFileInfo failed: "+r))}}function Qe(r,n,e){var i=n==null?"_":"_key_"+n+"_";return"qiniu_js_sdk_upload_file_name_"+r+i+"size_"+e}function Q(r,n){try{localStorage.removeItem(r)}catch{n.warn(new _(b.RemoveCacheFailed,"removeLocalFileInfo failed. key: "+r))}}function et(r,n){var e=null;try{e=localStorage.getItem(r)}catch{n.warn(new _(b.ReadCacheFailed,"getLocalFileInfo failed. key: "+r))}if(e==null)return null;var i=null;try{i=JSON.parse(e)}catch{Q(r,n),n.warn(new _(b.InvalidCacheData,"getLocalFileInfo failed to parse. key: "+r))}return i}function X(r){var n="UpToken "+r;return{Authorization:n}}function tt(r){var n=X(r);return G({"content-type":"application/octet-stream"},n)}function nt(r){var n=X(r);return G({"content-type":"application/json"},n)}function de(){if(window.XMLHttpRequest)return new XMLHttpRequest;if(window.ActiveXObject)return new window.ActiveXObject("Microsoft.XMLHTTP");throw new _(b.NotAvailableXMLHttpRequest,"the current environment does not support.")}function rt(r){return Ne(this,void 0,void 0,function(){var n,e;return Xe(this,function(i){switch(i.label){case 0:return[4,it(r)];case 1:return n=i.sent(),e=new Ge.ArrayBuffer,e.append(n),[2,e.end()]}})})}function it(r){return new Promise(function(n,e){var i=new FileReader;i.onload=function(o){if(o.target){var t=o.target.result;n(t)}else e(new _(b.InvalidProgressEventTarget,"progress event target is undefined"))},i.onerror=function(){e(new _(b.FileReaderReadFailed,"fileReader read failed"))},i.readAsArrayBuffer(r)})}function j(r,n){return new Promise(function(e,i){var o=de();if(o.open(n.method,r),n.onCreate&&n.onCreate(o),n.headers){var t=n.headers;Object.keys(t).forEach(function(l){o.setRequestHeader(l,t[l])})}o.upload.addEventListener("progress",function(l){l.lengthComputable&&n.onProgress&&n.onProgress({loaded:l.loaded,total:l.total})}),o.onreadystatechange=function(){var l=o.responseText;if(o.readyState===4){var p=o.getResponseHeader("x-reqId")||"";if(o.status===0){i(new Re("network error.",p));return}if(o.status!==200){var y="xhr request failed, code: "+o.status;l&&(y+=" response: "+l);var a=void 0;try{a=JSON.parse(l)}catch{}i(new M(o.status,p,y,a));return}try{e({data:JSON.parse(l),reqId:p})}catch(h){i(h)}}},o.send(n.body)})}function ot(r){if(r&&r.match){var n=r.match(/(^https?)/);if(!n)return"";var e=n[1];return n=r.match(/^https?:\/\/([^:^/]*):(\d*)/),n?n[2]:e==="http"?"80":"443"}return""}function at(r){if(r&&r.match){var n=r.match(/^https?:\/\/([^:^/]*)/);return n?n[1]:""}return""}function te(r){if(!r)throw new _(b.InvalidToken,"invalid token.");var n=r.split(":");if(n.length===1)throw new _(b.InvalidToken,"invalid token segments.");var e=n.length>3?n[1]:n[0];if(!e)throw new _(b.InvalidToken,"missing assess key field.");var i=null;try{i=JSON.parse($e(n[n.length-1]))}catch{throw new _(b.InvalidToken,"token parse failed.")}if(i==null)throw new _(b.InvalidToken,"putPolicy is null.");if(i.scope==null)throw new _(b.InvalidToken,"scope field is null.");var o=i.scope.split(":")[0];if(!o)throw new _(b.InvalidToken,"resolve bucketName failed.");return{assessKey:e,bucketName:o,scope:i.scope}}var I,E={z0:"z0",z1:"z1",z2:"z2",na0:"na0",as0:"as0",cnEast2:"cn-east-2"},st=(I={},I[E.z0]={srcUphost:["up.qiniup.com"],cdnUphost:["upload.qiniup.com"]},I[E.z1]={srcUphost:["up-z1.qiniup.com"],cdnUphost:["upload-z1.qiniup.com"]},I[E.z2]={srcUphost:["up-z2.qiniup.com"],cdnUphost:["upload-z2.qiniup.com"]},I[E.na0]={srcUphost:["up-na0.qiniup.com"],cdnUphost:["upload-na0.qiniup.com"]},I[E.as0]={srcUphost:["up-as0.qiniup.com"],cdnUphost:["upload-as0.qiniup.com"]},I[E.cnEast2]={srcUphost:["up-cn-east-2.qiniup.com"],cdnUphost:["upload-cn-east-2.qiniup.com"]},I),T=function(r){switch(typeof r){case"string":return r;case"boolean":return r?"true":"false";case"number":return isFinite(r)?r:"";default:return""}},ut=function(r,n,e,i){return n=n||"&",e=e||"=",r===null&&(r=void 0),typeof r=="object"?Object.keys(r).map(function(o){var t=encodeURIComponent(T(o))+e;return Array.isArray(r[o])?r[o].map(function(l){return t+encodeURIComponent(T(l))}).join(n):t+encodeURIComponent(T(r[o]))}).filter(Boolean).join(n):i?encodeURIComponent(T(i))+e+encodeURIComponent(T(r)):""},pe;pe=ut;var z=function(){return z=Object.assign||function(r){for(var n,e=1,i=arguments.length;e<i;e++){n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])}return r},z.apply(this,arguments)},ct=function(r,n,e,i){function o(t){return t instanceof e?t:new e(function(l){l(t)})}return new(e||(e=Promise))(function(t,l){function p(h){try{a(i.next(h))}catch(v){l(v)}}function y(h){try{a(i.throw(h))}catch(v){l(v)}}function a(h){h.done?t(h.value):o(h.value).then(p,y)}a((i=i.apply(r,n||[])).next())})},ft=function(r,n){var e={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},i,o,t,l;return l={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function p(a){return function(h){return y([a,h])}}function y(a){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,o&&(t=a[0]&2?o.return:a[0]?o.throw||((t=o.return)&&t.call(o),0):o.next)&&!(t=t.call(o,a[1])).done)return t;switch(o=0,t&&(a=[a[0]&2,t.value]),a[0]){case 0:case 1:t=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,o=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(t=e.trys,!(t=t.length>0&&t[t.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!t||a[1]>t[0]&&a[1]<t[3])){e.label=a[1];break}if(a[0]===6&&e.label<t[1]){e.label=t[1],t=a;break}if(t&&e.label<t[2]){e.label=t[2],e.ops.push(a);break}t[2]&&e.ops.pop(),e.trys.pop();continue}a=n.call(r,e)}catch(h){a=[6,h],o=0}finally{i=t=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};function lt(r,n,e){return ct(this,void 0,void 0,function(){var i,o;return ft(this,function(t){return i=pe({ak:r,bucket:n}),o=e+"://api.qiniu.com/v2/query?"+i,[2,j(o,{method:"GET"})]})})}function ge(r,n,e){var i=e.url,o=e.id;return i+"/buckets/"+r+"/objects/"+(n!=null?le(n):"~")+"/uploads/"+o}function ht(r,n,e,i){var o=i+"/buckets/"+n+"/objects/"+(e!=null?le(e):"~")+"/uploads";return j(o,{method:"POST",headers:X(r)})}function dt(r,n,e,i,o){var t=te(r).bucketName,l=ge(t,n,i)+("/"+e),p=tt(r);return o.md5&&(p["Content-MD5"]=o.md5),j(l,z(z({},o),{method:"PUT",headers:p}))}function pt(r,n,e,i){var o=te(r).bucketName,t=ge(o,n,e);return j(t,z(z({},i),{method:"POST",headers:nt(r)}))}function gt(r,n,e){return j(r,z({method:"POST",body:n},e))}var N=function(){return N=Object.assign||function(r){for(var n,e=1,i=arguments.length;e<i;e++){n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])}return r},N.apply(this,arguments)},re=function(r,n,e,i){function o(t){return t instanceof e?t:new e(function(l){l(t)})}return new(e||(e=Promise))(function(t,l){function p(h){try{a(i.next(h))}catch(v){l(v)}}function y(h){try{a(i.throw(h))}catch(v){l(v)}}function a(h){h.done?t(h.value):o(h.value).then(p,y)}a((i=i.apply(r,n||[])).next())})},ie=function(r,n){var e={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},i,o,t,l;return l={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function p(a){return function(h){return y([a,h])}}function y(a){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,o&&(t=a[0]&2?o.return:a[0]?o.throw||((t=o.return)&&t.call(o),0):o.next)&&!(t=t.call(o,a[1])).done)return t;switch(o=0,t&&(a=[a[0]&2,t.value]),a[0]){case 0:case 1:t=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,o=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(t=e.trys,!(t=t.length>0&&t[t.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!t||a[1]>t[0]&&a[1]<t[3])){e.label=a[1];break}if(a[0]===6&&e.label<t[1]){e.label=t[1],t=a;break}if(t&&e.label<t[2]){e.label=t[2],e.ops.push(a);break}t[2]&&e.ops.pop(),e.trys.pop();continue}a=n.call(r,e)}catch(h){a=[6,h],o=0}finally{i=t=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},yt=function(r,n){var e=typeof Symbol=="function"&&r[Symbol.iterator];if(!e)return r;var i=e.call(r),o,t=[],l;try{for(;(n===void 0||n-- >0)&&!(o=i.next()).done;)t.push(o.value)}catch(p){l={error:p}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(l)throw l.error}}return t},vt=function(){for(var r=[],n=0;n<arguments.length;n++)r=r.concat(yt(arguments[n]));return r},mt=4,ye=[0,502,503,504,599],bt=vt(ye,[612]),wt=Math.pow(1024,3),ve=function(){function r(n,e,i,o){this.hostPool=i,this.logger=o,this.aborted=!1,this.retryCount=0,this.xhrList=[],this.config=n.config,o.info("config inited.",this.config),this.putExtra=N({fname:""},n.putExtra),o.info("putExtra inited.",this.putExtra),this.key=n.key,this.file=n.file,this.token=n.token,this.onData=e.onData,this.onError=e.onError,this.onComplete=e.onComplete;try{var t=te(this.token);this.bucketName=t.bucketName,this.assessKey=t.assessKey}catch(l){o.error("get putPolicy from token failed.",l),this.onError(l)}}return r.prototype.checkAndUpdateUploadHost=function(){return re(this,void 0,void 0,function(){var n;return ie(this,function(e){switch(e.label){case 0:return this.logger.info("get available upload host."),[4,this.hostPool.getUp(this.assessKey,this.bucketName,this.config.upprotocol)];case 1:if(n=e.sent(),n==null)throw new _(b.NotAvailableUploadHost,"no available upload host.");return this.uploadHost!=null&&this.uploadHost.host!==n.host?this.logger.warn("host switches from "+this.uploadHost.host+" to "+n.host+"."):this.logger.info("use host "+n.host+"."),this.uploadHost=n,[2]}})})},r.prototype.checkAndUnfreezeHost=function(){this.logger.info("check unfreeze host."),this.uploadHost!=null&&this.uploadHost.isFrozen()&&(this.logger.warn(this.uploadHost.host+" will be unfrozen."),this.uploadHost.unfreeze())},r.prototype.checkAndFreezeHost=function(n){this.logger.info("check freeze host."),n instanceof M&&this.uploadHost!=null&&ye.includes(n.code)&&(this.logger.warn(this.uploadHost.host+" will be temporarily frozen."),this.uploadHost.freeze())},r.prototype.handleError=function(n){this.logger.error(n.message),this.onError(n)},r.prototype.putFile=function(){return re(this,void 0,void 0,function(){var n,e,i,o;return ie(this,function(t){switch(t.label){case 0:if(this.aborted=!1,this.putExtra.fname||(this.logger.info("use file.name as fname."),this.putExtra.fname=this.file.name),this.file.size>1e4*wt)return this.handleError(new _(b.InvalidFile,"file size exceed maximum value 10000G")),[2];if(this.putExtra.customVars&&!Ke(this.putExtra.customVars))return this.handleError(new _(b.InvalidCustomVars,"customVars key should start width x:")),[2];if(this.putExtra.metadata&&!We(this.putExtra.metadata))return this.handleError(new _(b.InvalidMetadata,"metadata key should start with x-qn-meta-")),[2];t.label=1;case 1:return t.trys.push([1,4,,5]),this.uploadAt=new Date().getTime(),[4,this.checkAndUpdateUploadHost()];case 2:return t.sent(),[4,this.run()];case 3:return n=t.sent(),this.onComplete(n.data),this.checkAndUnfreezeHost(),this.sendLog(n.reqId,200),[2];case 4:return e=t.sent(),this.aborted?(this.logger.warn("upload is aborted."),this.sendLog("",-2),[2]):(this.clear(),this.logger.error(e),e instanceof M&&(this.sendLog(e.reqId,e.code),this.checkAndFreezeHost(e),i=++this.retryCount<=this.config.retryCount,o=bt.includes(e.code),o&&i)?(this.logger.warn("error auto retry: "+this.retryCount+"/"+this.config.retryCount+"."),this.putFile(),[2]):(this.onError(e),[3,5]));case 5:return[2]}})})},r.prototype.clear=function(){this.xhrList.forEach(function(n){n.onreadystatechange=null,n.abort()}),this.xhrList=[],this.logger.info("cleanup uploading xhr.")},r.prototype.stop=function(){this.logger.info("aborted."),this.clear(),this.aborted=!0},r.prototype.addXhr=function(n){this.xhrList.push(n)},r.prototype.sendLog=function(n,e){var i,o;this.logger.report({code:e,reqId:n,remoteIp:"",upType:"jssdk-h5",size:this.file.size,time:Math.floor(this.uploadAt/1e3),port:ot((i=this.uploadHost)===null||i===void 0?void 0:i.getUrl()),host:at((o=this.uploadHost)===null||o===void 0?void 0:o.getUrl()),bytesSent:this.progress?this.progress.total.loaded:0,duration:Math.floor((new Date().getTime()-this.uploadAt)/1e3)})},r.prototype.getProgressInfoItem=function(n,e,i){return N({size:e,loaded:n,percent:n/e*100},i==null?{}:{fromCache:i})},r}(),_t=function(){var r=function(n,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var t in o)o.hasOwnProperty(t)&&(i[t]=o[t])},r(n,e)};return function(n,e){r(n,e);function i(){this.constructor=n}n.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),B=function(){return B=Object.assign||function(r){for(var n,e=1,i=arguments.length;e<i;e++){n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])}return r},B.apply(this,arguments)},D=function(r,n,e,i){function o(t){return t instanceof e?t:new e(function(l){l(t)})}return new(e||(e=Promise))(function(t,l){function p(h){try{a(i.next(h))}catch(v){l(v)}}function y(h){try{a(i.throw(h))}catch(v){l(v)}}function a(h){h.done?t(h.value):o(h.value).then(p,y)}a((i=i.apply(r,n||[])).next())})},H=function(r,n){var e={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},i,o,t,l;return l={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function p(a){return function(h){return y([a,h])}}function y(a){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,o&&(t=a[0]&2?o.return:a[0]?o.throw||((t=o.return)&&t.call(o),0):o.next)&&!(t=t.call(o,a[1])).done)return t;switch(o=0,t&&(a=[a[0]&2,t.value]),a[0]){case 0:case 1:t=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,o=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(t=e.trys,!(t=t.length>0&&t[t.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!t||a[1]>t[0]&&a[1]<t[3])){e.label=a[1];break}if(a[0]===6&&e.label<t[1]){e.label=t[1],t=a;break}if(t&&e.label<t[2]){e.label=t[2],e.ops.push(a);break}t[2]&&e.ops.pop(),e.trys.pop();continue}a=n.call(r,e)}catch(h){a=[6,h],o=0}finally{i=t=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};function xt(r){var n=/^[1-9]\d*$/;return n.test(String(r))}var Ct=function(r){_t(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return D(this,void 0,void 0,function(){var e,i,o,t,l,p=this;return H(this,function(y){switch(y.label){case 0:if(this.logger.info("start run Resume."),!this.config.chunkSize||!xt(this.config.chunkSize))throw new _(b.InvalidChunkSize,"chunkSize must be a positive integer");if(this.config.chunkSize>1024)throw new _(b.InvalidChunkSize,"chunkSize maximum value is 1024");return[4,this.initBeforeUploadChunks()];case 1:y.sent(),e=new Pe(function(a){return D(p,void 0,void 0,function(){return H(this,function(h){switch(h.label){case 0:if(this.aborted)throw e.abort(),new Error("pool is aborted");return[4,this.uploadChunk(a)];case 1:return h.sent(),[2]}})})},this.config.concurrentRequestLimit),i=null,o=this.getLocalKey(),t=this.chunks.map(function(a,h){return e.enqueue({chunk:a,index:h})}),y.label=2;case 2:return y.trys.push([2,5,,6]),[4,Promise.all(t)];case 3:return y.sent(),[4,this.mkFileReq()];case 4:return i=y.sent(),[3,6];case 5:throw l=y.sent(),l instanceof M&&(l.code===612||l.code===400)&&Q(o,this.logger),l;case 6:return Q(o,this.logger),[2,i]}})})},n.prototype.uploadChunk=function(e){return D(this,void 0,void 0,function(){var i,o,t,l,p,y,a,h,v,x=this;return H(this,function(C){switch(C.label){case 0:return i=e.index,o=e.chunk,t=this.cachedUploadedList[i],this.logger.info("upload part "+i+", cache:",t),l=this.config.checkByMD5,p=function(){x.usedCacheList[i]=!0,x.updateChunkProgress(o.size,i),x.uploadedList[i]=t,x.updateLocalCache()},t&&!l?(p(),[2]):[4,rt(o)];case 1:return y=C.sent(),this.logger.info("computed part md5.",y),t&&y===t.md5?(p(),[2]):(this.usedCacheList[i]=!1,a=function(U){x.updateChunkProgress(U.loaded,i)},h={body:o,md5:this.config.checkByServer?y:void 0,onProgress:a,onCreate:function(U){return x.addXhr(U)}},this.logger.info("part "+i+" start uploading."),[4,dt(this.token,this.key,e.index+1,this.getUploadInfo(),h)]);case 2:return v=C.sent(),this.logger.info("part "+i+" upload completed."),a({loaded:o.size,total:o.size}),this.uploadedList[i]={etag:v.data.etag,md5:v.data.md5,size:o.size},this.updateLocalCache(),[2]}})})},n.prototype.mkFileReq=function(){return D(this,void 0,void 0,function(){var e,i,o=this;return H(this,function(t){switch(t.label){case 0:return e=B(B(B({parts:this.uploadedList.map(function(l,p){return{etag:l.etag,partNumber:p+1}}),fname:this.putExtra.fname},this.putExtra.mimeType&&{mimeType:this.putExtra.mimeType}),this.putExtra.customVars&&{customVars:this.putExtra.customVars}),this.putExtra.metadata&&{metadata:this.putExtra.metadata}),this.logger.info("parts upload completed, make file.",e),[4,pt(this.token,this.key,this.getUploadInfo(),{onCreate:function(l){return o.addXhr(l)},body:JSON.stringify(e)})];case 1:return i=t.sent(),this.logger.info("finish Resume Progress."),this.updateMkFileProgress(1),[2,i]}})})},n.prototype.initBeforeUploadChunks=function(){return D(this,void 0,void 0,function(){var e,i,o;return H(this,function(t){switch(t.label){case 0:return this.uploadedList=[],this.usedCacheList=[],e=et(this.getLocalKey(),this.logger),e?[3,2]:(this.logger.info("init upload parts from api."),[4,ht(this.token,this.bucketName,this.key,this.uploadHost.getUrl())]);case 1:return i=t.sent(),this.logger.info("initd upload parts of id: "+i.data.uploadId+"."),this.uploadId=i.data.uploadId,this.cachedUploadedList=[],[3,3];case 2:o=["resume upload parts from local cache,","total "+e.data.length+" part,","id is "+e.id+"."],this.logger.info(o.join(" ")),this.cachedUploadedList=e.data,this.uploadId=e.id,t.label=3;case 3:return this.chunks=Je(this.file,this.config.chunkSize),this.loaded={mkFileProgress:0,chunks:this.chunks.map(function(l){return 0})},this.notifyResumeProgress(),[2]}})})},n.prototype.getUploadInfo=function(){return{id:this.uploadId,url:this.uploadHost.getUrl()}},n.prototype.getLocalKey=function(){return Qe(this.file.name,this.key,this.file.size)},n.prototype.updateLocalCache=function(){Ze(this.getLocalKey(),{id:this.uploadId,data:this.uploadedList},this.logger)},n.prototype.updateChunkProgress=function(e,i){this.loaded.chunks[i]=e,this.notifyResumeProgress()},n.prototype.updateMkFileProgress=function(e){this.loaded.mkFileProgress=e,this.notifyResumeProgress()},n.prototype.notifyResumeProgress=function(){var e=this;this.progress={total:this.getProgressInfoItem(Ye(this.loaded.chunks)+this.loaded.mkFileProgress,this.file.size+1),chunks:this.chunks.map(function(i,o){var t=e.usedCacheList[o];return e.getProgressInfoItem(e.loaded.chunks[o],i.size,t)}),uploadInfo:{id:this.uploadId,url:this.uploadHost.getUrl()}},this.onData(this.progress)},n}(ve),oe=function(r,n,e,i){function o(t){return t instanceof e?t:new e(function(l){l(t)})}return new(e||(e=Promise))(function(t,l){function p(h){try{a(i.next(h))}catch(v){l(v)}}function y(h){try{a(i.throw(h))}catch(v){l(v)}}function a(h){h.done?t(h.value):o(h.value).then(p,y)}a((i=i.apply(r,n||[])).next())})},ae=function(r,n){var e={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},i,o,t,l;return l={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function p(a){return function(h){return y([a,h])}}function y(a){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,o&&(t=a[0]&2?o.return:a[0]?o.throw||((t=o.return)&&t.call(o),0):o.next)&&!(t=t.call(o,a[1])).done)return t;switch(o=0,t&&(a=[a[0]&2,t.value]),a[0]){case 0:case 1:t=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,o=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(t=e.trys,!(t=t.length>0&&t[t.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!t||a[1]>t[0]&&a[1]<t[3])){e.label=a[1];break}if(a[0]===6&&e.label<t[1]){e.label=t[1],t=a;break}if(t&&e.label<t[2]){e.label=t[2],e.ops.push(a);break}t[2]&&e.ops.pop(),e.trys.pop();continue}a=n.call(r,e)}catch(h){a=[6,h],o=0}finally{i=t=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},kt=function(){function r(){this.crc=-1,this.table=this.makeTable()}return r.prototype.makeTable=function(){for(var n=new Array,e=0;e<256;e++){for(var i=e,o=0;o<8;o++)i&1?i=i>>>1^3988292384:i>>>=1;n[e]=i}return n},r.prototype.append=function(n){for(var e=this.crc,i=0;i<n.byteLength;i++)e=e>>>8^this.table[(e^n[i])&255];this.crc=e},r.prototype.compute=function(){return(this.crc^-1)>>>0},r.prototype.readAsUint8Array=function(n){return oe(this,void 0,void 0,function(){var e;return ae(this,function(i){switch(i.label){case 0:return typeof n.arrayBuffer!="function"?[3,2]:(e=Uint8Array.bind,[4,n.arrayBuffer()]);case 1:return[2,new(e.apply(Uint8Array,[void 0,i.sent()]))];case 2:return[2,new Promise(function(o,t){var l=new FileReader;l.onload=function(){if(l.result==null){t();return}if(typeof l.result=="string"){t();return}o(new Uint8Array(l.result))},l.readAsArrayBuffer(n)})]}})})},r.prototype.file=function(n){return oe(this,void 0,void 0,function(){var e,i,o,t,l,p;return ae(this,function(y){switch(y.label){case 0:return n.size<=R?(e=this.append,[4,this.readAsUint8Array(n)]):[3,2];case 1:return e.apply(this,[y.sent()]),[2,this.compute()];case 2:i=Math.ceil(n.size/R),o=0,y.label=3;case 3:return o<i?(t=o*R,l=o===i-1?n.size:t+R,[4,this.readAsUint8Array(n.slice(t,l))]):[3,6];case 4:p=y.sent(),this.append(new Uint8Array(p)),y.label=5;case 5:return o++,[3,3];case 6:return[2,this.compute()]}})})},r.file=function(n){var e=new r;return e.file(n)},r}(),St=function(){var r=function(n,e){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,o){i.__proto__=o}||function(i,o){for(var t in o)o.hasOwnProperty(t)&&(i[t]=o[t])},r(n,e)};return function(n,e){r(n,e);function i(){this.constructor=n}n.prototype=e===null?Object.create(e):(i.prototype=e.prototype,new i)}}(),At=function(r,n,e,i){function o(t){return t instanceof e?t:new e(function(l){l(t)})}return new(e||(e=Promise))(function(t,l){function p(h){try{a(i.next(h))}catch(v){l(v)}}function y(h){try{a(i.throw(h))}catch(v){l(v)}}function a(h){h.done?t(h.value):o(h.value).then(p,y)}a((i=i.apply(r,n||[])).next())})},It=function(r,n){var e={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},i,o,t,l;return l={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function p(a){return function(h){return y([a,h])}}function y(a){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,o&&(t=a[0]&2?o.return:a[0]?o.throw||((t=o.return)&&t.call(o),0):o.next)&&!(t=t.call(o,a[1])).done)return t;switch(o=0,t&&(a=[a[0]&2,t.value]),a[0]){case 0:case 1:t=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,o=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(t=e.trys,!(t=t.length>0&&t[t.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!t||a[1]>t[0]&&a[1]<t[3])){e.label=a[1];break}if(a[0]===6&&e.label<t[1]){e.label=t[1],t=a;break}if(t&&e.label<t[2]){e.label=t[2],e.ops.push(a);break}t[2]&&e.ops.pop(),e.trys.pop();continue}a=n.call(r,e)}catch(h){a=[6,h],o=0}finally{i=t=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},se=function(r){St(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.run=function(){return At(this,void 0,void 0,function(){var e,i,o,t,l,p=this;return It(this,function(y){switch(y.label){case 0:return this.logger.info("start run Direct."),e=new FormData,e.append("file",this.file),e.append("token",this.token),this.key!=null&&e.append("key",this.key),e.append("fname",this.putExtra.fname),this.config.checkByServer?[4,kt.file(this.file)]:[3,2];case 1:i=y.sent(),e.append("crc32",i.toString()),y.label=2;case 2:return this.putExtra.customVars&&(this.logger.info("init customVars."),o=this.putExtra.customVars,Object.keys(o).forEach(function(a){return e.append(a,o[a].toString())}),this.logger.info("customVars inited.")),this.putExtra.metadata&&(this.logger.info("init metadata."),t=this.putExtra.metadata,Object.keys(t).forEach(function(a){return e.append(a,t[a].toString())})),this.logger.info("formData inited."),[4,gt(this.uploadHost.getUrl(),e,{onProgress:function(a){p.updateDirectProgress(a.loaded,a.total)},onCreate:function(a){return p.addXhr(a)}})];case 3:return l=y.sent(),this.logger.info("Direct progress finish."),this.finishDirectProgress(),[2,l]}})})},n.prototype.updateDirectProgress=function(e,i){this.progress={total:this.getProgressInfoItem(e,i+1)},this.onData(this.progress)},n.prototype.finishDirectProgress=function(){if(!this.progress){this.logger.warn("progress is null."),this.progress={total:this.getProgressInfoItem(this.file.size,this.file.size)},this.onData(this.progress);return}var e=this.progress.total;this.progress={total:this.getProgressInfoItem(e.loaded+1,e.size)},this.onData(this.progress)},n}(ve);function me(r,n,e){e===void 0&&(e=3);var i=de();i.open("POST","https://uplog.qbox.me/log/3"),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.setRequestHeader("Authorization",X(r).Authorization),i.onreadystatechange=function(){i.readyState===4&&i.status!==200&&e>0&&me(r,n,e-1)};var o=[n.code||"",n.reqId||"",n.host||"",n.remoteIp||"",n.port||"",n.duration||"",n.time||"",n.bytesSent||"",n.upType||"",n.size||""].join(",");i.send(o)}var Ut=function(r,n){var e=typeof Symbol=="function"&&r[Symbol.iterator];if(!e)return r;var i=e.call(r),o,t=[],l;try{for(;(n===void 0||n-- >0)&&!(o=i.next()).done;)t.push(o.value)}catch(p){l={error:p}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(l)throw l.error}}return t},Y=function(){for(var r=[],n=0;n<arguments.length;n++)r=r.concat(Ut(arguments[n]));return r},Ft=function(){function r(n,e,i,o){e===void 0&&(e=!0),i===void 0&&(i="OFF"),o===void 0&&(o="UPLOAD"),this.token=n,this.disableReport=e,this.level=i,this.prefix=o,this.id=++r.id}return r.prototype.getPrintPrefix=function(n){return"Qiniu-JS-SDK ["+n+"]["+this.prefix+"#"+this.id+"]:"},r.prototype.report=function(n,e){if(!this.disableReport)try{me(this.token,n,e)}catch(i){this.warn(i)}},r.prototype.info=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var i=["INFO"];i.includes(this.level)&&console.log.apply(console,Y([this.getPrintPrefix("INFO")],n))},r.prototype.warn=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var i=["INFO","WARN"];i.includes(this.level)&&console.warn.apply(console,Y([this.getPrintPrefix("WARN")],n))},r.prototype.error=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];var i=["INFO","WARN","ERROR"];i.includes(this.level)&&console.error.apply(console,Y([this.getPrintPrefix("ERROR")],n))},r.id=0,r}(),ue=function(r,n,e,i){function o(t){return t instanceof e?t:new e(function(l){l(t)})}return new(e||(e=Promise))(function(t,l){function p(h){try{a(i.next(h))}catch(v){l(v)}}function y(h){try{a(i.throw(h))}catch(v){l(v)}}function a(h){h.done?t(h.value):o(h.value).then(p,y)}a((i=i.apply(r,n||[])).next())})},ce=function(r,n){var e={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},i,o,t,l;return l={next:p(0),throw:p(1),return:p(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function p(a){return function(h){return y([a,h])}}function y(a){if(i)throw new TypeError("Generator is already executing.");for(;e;)try{if(i=1,o&&(t=a[0]&2?o.return:a[0]?o.throw||((t=o.return)&&t.call(o),0):o.next)&&!(t=t.call(o,a[1])).done)return t;switch(o=0,t&&(a=[a[0]&2,t.value]),a[0]){case 0:case 1:t=a;break;case 4:return e.label++,{value:a[1],done:!1};case 5:e.label++,o=a[1],a=[0];continue;case 7:a=e.ops.pop(),e.trys.pop();continue;default:if(t=e.trys,!(t=t.length>0&&t[t.length-1])&&(a[0]===6||a[0]===2)){e=0;continue}if(a[0]===3&&(!t||a[1]>t[0]&&a[1]<t[3])){e.label=a[1];break}if(a[0]===6&&e.label<t[1]){e.label=t[1],t=a;break}if(t&&e.label<t[2]){e.label=t[2],e.ops.push(a);break}t[2]&&e.ops.pop(),e.trys.pop();continue}a=n.call(r,e)}catch(h){a=[6,h],o=0}finally{i=t=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},Ot=function(r,n){var e=typeof Symbol=="function"&&r[Symbol.iterator];if(!e)return r;var i=e.call(r),o,t=[],l;try{for(;(n===void 0||n-- >0)&&!(o=i.next()).done;)t.push(o.value)}catch(p){l={error:p}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(l)throw l.error}}return t},zt=function(){for(var r=[],n=0;n<arguments.length;n++)r=r.concat(Ot(arguments[n]));return r},V=new Map,Et=function(){function r(n,e){this.host=n,this.protocol=e}return r.prototype.isFrozen=function(){var n=new Date().getTime(),e=V.get(this.host);return e!=null&&e>=n},r.prototype.freeze=function(n){n===void 0&&(n=20);var e=new Date().getTime()+n*1e3;V.set(this.host,e)},r.prototype.unfreeze=function(){V.delete(this.host)},r.prototype.getUrl=function(){return this.protocol+"://"+this.host},r.prototype.getUnfreezeTime=function(){return V.get(this.host)},r}(),Rt=function(){function r(n){n===void 0&&(n=[]),this.initHosts=n,this.cachedHostsMap=new Map}return r.prototype.register=function(n,e,i,o){this.cachedHostsMap.set(n+"@"+e,i.map(function(t){return new Et(t,o)}))},r.prototype.refresh=function(n,e,i){var o,t,l,p;return ue(this,void 0,void 0,function(){var y,a,h;return ce(this,function(v){switch(v.label){case 0:return y=this.cachedHostsMap.get(n+"@"+e)||[],y.length>0?[2]:this.initHosts.length>0?(this.register(n,e,this.initHosts,i),[2]):[4,lt(n,e,i)];case 1:return a=v.sent(),(a==null?void 0:a.data)!=null&&(h=zt(((t=(o=a.data.up)===null||o===void 0?void 0:o.acc)===null||t===void 0?void 0:t.main)||[],((p=(l=a.data.up)===null||l===void 0?void 0:l.acc)===null||p===void 0?void 0:p.backup)||[]),this.register(n,e,h,i)),[2]}})})},r.prototype.getUp=function(n,e,i){return ue(this,void 0,void 0,function(){var o,t,l;return ce(this,function(p){switch(p.label){case 0:return[4,this.refresh(n,e,i)];case 1:return p.sent(),o=this.cachedHostsMap.get(n+"@"+e)||[],o.length===0?[2,null]:(t=o.filter(function(y){return!y.isFrozen()}),t.length>0?[2,t[0]]:(l=o.slice().sort(function(y,a){return(y.getUnfreezeTime()||0)-(a.getUnfreezeTime()||0)}),[2,l[0]]))}})})},r}();function Pt(r,n,e,i){return r.config&&r.config.forceDirect?(i.info("ues forceDirect mode."),new se(r,n,e,i)):r.file.size>4*R?(i.info("file size over 4M, use Resume."),new Ct(r,n,e,i)):(i.info("file size less or equal than 4M, use Direct."),new se(r,n,e,i))}function Lt(r,n,e,i,o){var t=new Ft(e,void 0,void 0,r.name),l={file:r,key:n,token:e,putExtra:i,config:Ht(o,t)},p=new Rt(l.config.uphost);return new He(function(y){var a=Pt(l,{onData:function(h){return y.next(h)},onError:function(h){return y.error(h)},onComplete:function(h){return y.complete(h)}},p,t);return a.putFile(),a.stop.bind(a)})}var P=function(){return P=Object.assign||function(r){for(var n,e=1,i=arguments.length;e<i;e++){n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(r[o]=n[o])}return r},P.apply(this,arguments)},Tt=function(r,n){var e={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&n.indexOf(i)<0&&(e[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,i=Object.getOwnPropertySymbols(r);o<i.length;o++)n.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(r,i[o])&&(e[i[o]]=r[i[o]]);return e},Dt=function(r,n){var e=typeof Symbol=="function"&&r[Symbol.iterator];if(!e)return r;var i=e.call(r),o,t=[],l;try{for(;(n===void 0||n-- >0)&&!(o=i.next()).done;)t.push(o.value)}catch(p){l={error:p}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(l)throw l.error}}return t},Z=function(){for(var r=[],n=0;n<arguments.length;n++)r=r.concat(Dt(arguments[n]));return r};function Ht(r,n){var e=P({},r),i=e.upprotocol,o=e.uphost,t=Tt(e,["upprotocol","uphost"]),l=P({uphost:[],retryCount:3,checkByMD5:!1,forceDirect:!1,useCdnDomain:!0,checkByServer:!1,concurrentRequestLimit:3,chunkSize:mt,upprotocol:"https",debugLogLevel:"OFF",disableStatisticsReport:!1},t);i&&(l.upprotocol=i.replace(/:$/,""));var p=[];if(o)Array.isArray(o)?p.push.apply(p,Z(o)):p.push(o);else if(l!=null&&l.region){var y=st[l==null?void 0:l.region];l.useCdnDomain?p.push.apply(p,Z(y.cdnUphost)):p.push.apply(p,Z(y.srcUphost))}return P(P({},l),{uphost:p.filter(Boolean)})}var ee={PNG:"image/png",JPEG:"image/jpeg",WEBP:"image/webp",BMP:"image/bmp"};Object.keys(ee).map(function(r){return ee[r]});ee.JPEG;const qt={class:"file-upload-drawer-container"},$t=we({name:"FileUploadDrawer",__name:"file-upload-drawer",emits:["changed"],setup(r,{expose:n,emit:e}){const i=e,o=A(),t=A(!1),l=A(!1),p=A(""),y=A(""),a=A([]),h=A([]),v=A([]),x=_e(()=>`上传文件到${Fe(p.value)?"根":p.value.substring(0,p.value.length-1)}目录`),C=s=>{p.value=s,l.value=!0,t.value=!0,Se.netDiskManage.netDiskManageToken().then(f=>{y.value=f.token,t.value=!1}).catch(()=>{l.value=!1})},U=()=>{a.value.length>0&&a.value.length!==h.value.length?Ae.confirm({title:"关闭会取消未上传的文件，确认关闭吗？",icon:$(Ie),onOk:F}):F()},F=()=>{l.value=!1,t.value=!1,p.value="",y.value="",v.value=[],u()},m=s=>{const{file:f,onProgress:c,onError:w,onSuccess:k}=s,L=Lt(f,`${p.value}${f.name}`,y.value).subscribe({next:O=>{c==null||c({percent:O.total.percent})},error:O=>{w==null||w(O),g(O,f),console.log("上传失败",O)},complete:O=>{h.value.push(L),k==null||k(O),d(f)}});a.value.push(L)},g=(s,f)=>{const c=v.value.find(w=>w.originFileObj===f);c&&(c.status="error"),ne.error({message:"上传进度提醒",description:`上传${f==null?void 0:f.name}文件失败！错误信息：${s.code===614?"上传文件已存在":s.message}`,duration:0})},d=s=>{const f=v.value.find(c=>c.originFileObj===s);f&&(f.status="success"),ne.success({message:`上传${f==null?void 0:f.name}成功`})},u=async()=>{if(a.value.length<=0)return;const s=a.value,f=h.value;if(a.value=[],h.value=[],s.length!==f.length)for(let c=0;c<s.length;c++)s[c].unsubscribe(),s[c]=null;await Ue(),i("changed")};return n({open:C}),(s,f)=>(xe(),Ce("div",qt,[$(W(Ee),{title:x.value,width:400,visible:l.value,"mask-closable":!1,onClose:U},{default:J(()=>[$(W(Oe),{spinning:t.value,class:"upload-inner-box"},{default:J(()=>[$(W(ze).Dragger,{ref_key:"uploadRef",ref:o,"file-list":v.value,"onUpdate:fileList":f[0]||(f[0]=c=>v.value=c),class:"upload",drag:"",action:"noaction",multiple:!0,"custom-request":m},{default:J(()=>f[1]||(f[1]=[K("i",{class:"el-icon-upload"},null,-1),K("div",{class:"el-upload__text"},[ke("将文件拖到此处，或"),K("em",null,"点击上传")],-1)])),_:1},8,["file-list"])]),_:1},8,["spinning"])]),_:1},8,["title","visible"])]))}});export{$t as _};
