import{B}from"./index-CflvCMxt.js";import{T as D}from"./index-Qnpm0yEw.js";import{c as l,I as C,d as N,n as y,q as V,E as i,G as u,F as r,H as b,B as h,y as j,L as q,aY as f,A as z,a8 as A}from"./index-B8Pm80oX.js";import{u as L,b as k}from"./dynamic-table-D22kRkZE.js";import"./ApiSelect.vue_vue_type_script_setup_true_lang-CofY2-NC.js";import"./dayjs.min-TeQhONF1.js";import"./index.vue_vue_type_style_index_0_lang-CFuk3e67.js";import{u as M}from"./useFormModal-CmrBxBAu.js";import{D as c}from"./index-Bp1gl4D3.js";import{P as E}from"./PoweroffOutlined-LDe6YSPj.js";import"./isNumeric-DjvBa-1E.js";import"./index-CWarxRuf.js";import"./index-CND5kIK4.js";import"./_baseUniq-kMXtQ-ld.js";import"./_arrayIncludesWith-DbV0gfeD.js";import"./collapseMotion-Dg6yIgr5.js";import"./move-B3QdINpa.js";import"./RightOutlined-BsZy0Phy.js";import"./VerticalRightOutlined-C0b_NAnm.js";import"./cloneDeep-lQkziu_-.js";import"./schema-form.vue_vue_type_script_setup_true_lang-CqVOkWCm.js";import"./isNumber-BQFvOqOr.js";import"./is-BPG7p_4t.js";import"./index-BT78Vb1q.js";import"./useFlexGapSupport-DLL49fC4.js";import"./hasIn-D18GTBYl.js";import"./debounce-TsE9rPWj.js";import"./QuestionCircleOutlined-DwMKnzgY.js";import"./_castArrayLikeObject-DUjGHYOU.js";import"./index-7VmM7i5b.js";import"./DownOutlined-BRycSuUV.js";import"./index-CIQauGJF.js";import"./dateUtil-E1W9AnjJ.js";import"./pick-yPjmipd3.js";import"./FullscreenOutlined-BZ3QrFwa.js";import"./index-CfT4fuvs.js";import"./LeftOutlined-BKTs5glU.js";import"./zh_CN-CAyhejr6.js";import"./index-iNKLbYy_.js";import"./useMergedState-Cz6_zboM.js";import"./index-B7GNZFXE.js";import"./EnterOutlined-BnZ699CI.js";import"./CheckOutlined-D9pyqrzu.js";import"./CopyOutlined-D95pQ5l8.js";import"./index-g76Nm4Kx.js";import"./isMobile-BbN7I0i_.js";import"./useRefs-QkKGnXKa.js";import"./index-DhL-eOiI.js";import"./index-BRG9fhiq.js";import"./index-B4w1aCCw.js";import"./useModal-ClPC9oek.js";var F={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M715.8 493.5L335 165.1c-14.2-12.2-35-1.2-35 18.5v656.8c0 19.7 20.8 30.7 35 18.5l380.8-328.4c10.9-9.4 10.9-27.6 0-37z"}}]},name:"caret-right",theme:"outlined"};function I(e){for(var a=1;a<arguments.length;a++){var n=arguments[a]!=null?Object(arguments[a]):{},p=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(p=p.concat(Object.getOwnPropertySymbols(n).filter(function(m){return Object.getOwnPropertyDescriptor(n,m).enumerable}))),p.forEach(function(m){G(e,m,n[m])})}return e}function G(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}var g=function(a,n){var p=I({},a,n.attrs);return l(C,I({},p,{icon:F}),null)};g.displayName="CaretRightOutlined";g.inheritAttrs=!1;var H={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M876.6 239.5c-.5-.9-1.2-1.8-2-2.5-5-5-13.1-5-18.1 0L684.2 409.3l-67.9-67.9L788.7 169c.8-.8 1.4-1.6 2-2.5 3.6-6.1 1.6-13.9-4.5-17.5-98.2-58-226.8-44.7-311.3 39.7-67 67-89.2 162-66.5 247.4l-293 293c-3 3-2.8 7.9.3 11l169.7 169.7c3.1 3.1 8.1 3.3 11 .3l292.9-292.9c85.5 22.8 180.5.7 247.6-66.4 84.4-84.5 97.7-213.1 39.7-311.3zM786 499.8c-58.1 58.1-145.3 69.3-214.6 33.6l-8.8 8.8-.1-.1-274 274.1-79.2-79.2 230.1-230.1s0 .1.1.1l52.8-52.8c-35.7-69.3-24.5-156.5 33.6-214.6a184.2 184.2 0 01144-53.5L537 318.9a32.05 32.05 0 000 45.3l124.5 124.5a32.05 32.05 0 0045.3 0l132.8-132.8c3.7 51.8-14.4 104.8-53.6 143.9z"}}]},name:"tool",theme:"outlined"};function O(e){for(var a=1;a<arguments.length;a++){var n=arguments[a]!=null?Object(arguments[a]):{},p=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(p=p.concat(Object.getOwnPropertySymbols(n).filter(function(m){return Object.getOwnPropertyDescriptor(n,m).enumerable}))),p.forEach(function(m){U(e,m,n[m])})}return e}function U(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}var v=function(a,n){var p=O({},a,n.attrs);return l(C,O({},p,{icon:H}),null)};v.displayName="ToolOutlined";v.inheritAttrs=!1;const W=e=>{switch(e){case 0:return"#d9d9d9";case 1:return"#52c41a"}},Y=e=>{switch(e){case 0:return"停止";case 1:return"运行"}},J=[{title:"任务名称",dataIndex:"name",width:180},{title:"状态",width:100,dataIndex:"status",customRender:({record:e})=>l(B,{status:e.status===1?"processing":"default",color:W(e.status),text:Y(e.status)},null)},{title:"类型",width:80,dataIndex:"type",customRender:({record:e})=>l(D,{color:"processing"},{default:()=>[e.type===1?"Interval":"Cron"]})},{title:"调用服务",dataIndex:"service",hideInSearch:!0,width:220},{title:"执行参数",dataIndex:"data",hideInSearch:!0,width:220},{title:"备注",dataIndex:"remark"}],Q=[{field:"type",component:"RadioGroup",label:"名称",defaultValue:0,rules:[{required:!0,type:"number"}],componentProps:{options:[{label:"Cron",value:0},{label:"时间间隔",value:1}]}},{field:"name",component:"Input",label:"任务名称",rules:[{required:!0,type:"string"}]},{field:"service",component:"Input",label:"服务路径",rules:[{required:!0,type:"string"}],componentProps:{placeholder:"请输入调用服务的路径"}},{field:"data",component:"Input",label:"任务参数",componentProps:{placeholder:"请输入任务参数（可不填）"}},{field:"limit",component:"InputNumber",label:"执行次数",defaultValue:-1,componentProps:{min:-1,style:{width:"100%"}}},{field:"cron",component:"Input",label:"Cron",rules:[{required:!0,type:"string"}],vIf:({formModel:e})=>e.type===0,componentProps:{placeholder:"请输入Cron表达式"}},{field:"every",component:"InputNumber",label:"执行间隔",defaultValue:6e4,vIf:({formModel:e})=>e.type===1,rules:[{required:!0,type:"number"}],componentProps:{min:100,style:{width:"100%"}}},{field:"startTime",component:"DatePicker",label:"开始时间",vIf:({formModel:e})=>e.type===0,componentProps:{showTime:!0,style:{width:"100%"}}},{field:"endTime",component:"DatePicker",label:"结束时间",vIf:({formModel:e})=>e.type===0,componentProps:{showTime:!0,style:{width:"100%"}}},{field:"remark",component:"InputTextArea",label:"备注"},{field:"status",component:"RadioGroup",defaultValue:1,label:"状态",componentProps:{options:[{label:"运行",value:1},{label:"停止",value:0}]}}],Yt=N({name:"SystemScheduleTask",__name:"index",setup(e){const[a,n]=L({search:!1,size:"small"}),[p]=M(),m=()=>n==null?void 0:n.reload(),T=async t=>{const[o]=await p({modalProps:{title:`${t.id?"编辑":"新增"}任务`,width:640,onFinish:async d=>{const s={...d,id:t.id};console.log("新增/编辑任务",s),t.id?await f.systemTask.taskUpdate({id:t.id},s):await f.systemTask.taskCreate(s),m()}},formProps:{labelWidth:100,schemas:Q}});if(t.id){const d=await f.systemTask.taskInfo({id:t.id});o==null||o.setFieldsValue({...t,...d})}},P=async t=>{await f.systemTask.taskDelete({id:t}),m()},$=async t=>{await f.systemTask.taskOnce({id:t.id}),m()},S=async t=>{await f.systemTask.taskStart({id:t.id}),m()},_=async t=>{await f.systemTask.taskStop({id:t.id}),m()},x=t=>!t.startTime&&!t.endTime?"无时段限制":!t.startTime&&t.endTime?`无开始时间限制 - ${t.endTime}`:t.startTime&&!t.endTime?`${t.startTime} - 长期有效`:`${t.startTime} - ${t.endTime}`,R=[...J,{title:"操作",width:220,dataIndex:"ACTION",fixed:"right",actions:({record:t})=>[{label:"编辑",auth:{perm:"system:task:update",effect:"disable"},onClick:()=>T(t)},{label:"删除",auth:"system:task:delete",popConfirm:{title:"你确定要删除吗？",onConfirm:()=>P(t.id)}}]}];return(t,o)=>{const d=z("a-button");return y(),V("div",null,[l(r(a),{"row-key":"id","header-title":"定时任务","data-request":r(f).systemTask.taskList,columns:R,scroll:{x:2e3},bordered:""},{toolbar:i(()=>[l(d,{type:"primary",disabled:!t.$auth("system:task:create"),onClick:o[0]||(o[0]=s=>T({}))},{default:i(()=>o[1]||(o[1]=[u(" 新增 ")])),_:1},8,["disabled"])]),expandedRowRender:i(({record:s})=>[l(r(c),{column:1},{default:i(()=>[l(r(c).Item,{label:"任务编号"},{default:i(()=>[u("# "+b(s.id),1)]),_:2},1024),l(r(c).Item,{label:"执行次数"},{default:i(()=>[u(b(s.limit>0?`仅 ${s.limit} 次`:"无次数限制"),1)]),_:2},1024),s.type===1?(y(),h(r(c).Item,{key:0,label:"执行间隔"},{default:i(()=>[u(" 每"+b(s.every)+"毫秒执行一次 ",1)]),_:2},1024)):(y(),h(r(c).Item,{key:1,label:"Cron表达式"},{default:i(()=>[l(r(A),null,{title:i(()=>o[2]||(o[2]=[u("秒 分 小时 日期 月份 星期 年(可选)")])),default:i(()=>[u(" "+b(s.cron),1)]),_:2},1024)]),_:2},1024)),s.type===0?(y(),h(r(c).Item,{key:2,label:"执行时间段"},{default:i(()=>[j("span",null,b(x(s)),1)]),_:2},1024)):q("",!0),l(r(c).Item,{label:"执行操作"},{default:i(()=>[l(r(k),{title:"确认手动执行一次该任务吗?",disabled:!t.$auth("system:task:once"),onConfirm:w=>$(s)},{default:i(()=>[l(d,{type:"link",size:"small",disabled:!t.$auth("system:task:once")},{icon:i(()=>[l(r(v))]),default:i(()=>[o[3]||(o[3]=u("仅一次 "))]),_:1},8,["disabled"])]),_:2},1032,["disabled","onConfirm"]),l(r(k),{title:"确认运行该任务吗?",disabled:!t.$auth("system:task:start")||s.status!==0,onConfirm:w=>S(s)},{default:i(()=>[l(d,{type:"link",size:"small",disabled:!t.$auth("system:task:start")||s.status!==0},{icon:i(()=>[l(r(g))]),default:i(()=>[o[4]||(o[4]=u("运行 "))]),_:2},1032,["disabled"])]),_:2},1032,["disabled","onConfirm"]),l(r(k),{title:"确认停止该任务吗?",disabled:!t.$auth("system:task:stop")||s.status!==1,onConfirm:w=>_(s)},{default:i(()=>[l(d,{type:"link",size:"small",disabled:!t.$auth("system:task:stop")||s.status!==1},{icon:i(()=>[l(r(E))]),default:i(()=>[o[5]||(o[5]=u("停止 "))]),_:2},1032,["disabled"])]),_:2},1032,["disabled","onConfirm"])]),_:2},1024)]),_:2},1024)]),_:1},8,["data-request"])])}}});export{Yt as default};
