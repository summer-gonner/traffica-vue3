import{f as B}from"./index-CIQauGJF.js";import{d as S,n as u,q as I,r as l,b as N,B as f,E as n,c as r,F as a,Q as V,K as $,G as x,a3 as E,aY as b,e7 as F,N as H,A as P,aX as L,H as U,a9 as j}from"./index-B8Pm80oX.js";import{f as q}from"./dateUtil-E1W9AnjJ.js";import{S as T}from"./index-CfT4fuvs.js";import{I as G}from"./index-CfCbjZdA.js";import{D as _}from"./index-Bp1gl4D3.js";import{D as K}from"./index-P37OXH9W.js";const Q=["data","type"],W=S({name:"preview-resource",__name:"index",props:{url:{type:String},type:{type:String}},setup(c){return(D,d)=>(u(),I("object",{key:c.url,data:c.url,type:c.type,width:"100%",height:"100%"},null,8,Q))}}),ae=S({name:"FilePreviewDrawer",__name:"file-preview-drawer",setup(c,{expose:D}){const d=new Map([["name","文件名"],["mimeType","文件类型"],["hash","文件Hash"],["md5","文件MD5"],["fsize","文件大小"],["putTime","上传时间"],["uploader","上传人员"]]),w=l(!1),g=l(!1),h=l(""),y=l(""),t=l({}),m=l(""),p=l(""),k=l(!1),z=N(()=>`${m.value}?imageView2/2/w/500/h/210`),C=async(o,s)=>{g.value=!0,h.value=o,y.value=s,await E();try{w.value=!0;const v={name:o,path:s},i=await b.netDiskManage.netDiskManageInfo(v);if(p.value=i.mark,Array.from(d.keys()).forEach(e=>{e==="fsize"?t.value.fsize=B(i[e]):t.value[e]=i[e]}),t.value.putTime=q(i.putTime),t.value.name=o,F("netdisk:manage:download")){const e=await b.netDiskManage.netDiskManageDownload(v);m.value=e}}catch{M()}finally{w.value=!1}},A=async()=>{try{k.value=!0,await b.netDiskManage.netDiskManageMark({name:h.value,path:y.value,mark:p.value}),H.success("已更新文件备注")}finally{k.value=!1}},M=()=>{h.value="",y.value="",m.value="",p.value="",t.value={},g.value=!1};return D({open:C}),(o,s)=>{const v=P("a-button");return u(),f(a(K),{title:"文件详情",width:500,visible:g.value,onClose:M},{default:n(()=>[r(a(L),{spinning:w.value,class:"preview-drawer-inner-box"},{default:n(()=>[r(a(T),{direction:"vertical"},{default:n(()=>{var i;return[(i=t.value.mimeType)!=null&&i.startsWith("image/")?(u(),f(a(G),{key:0,class:"w-full h-[210px]",src:z.value,preview:{src:m.value}},null,8,["src","preview"])):(u(),f(W,{key:1,class:"w-full h-[210px]",url:m.value,type:t.value.mimeType},null,8,["url","type"])),r(a(_),{bordered:"",column:1,size:"small"},{default:n(()=>[(u(!0),I($,null,V(a(d).keys(),e=>(u(),f(a(_).Item,{key:e,label:a(d).get(e),"label-style":{whiteSpace:"nowrap"}},{default:n(()=>[x(U(t.value[e]),1)]),_:2},1032,["label"]))),128)),r(a(_).Item,{label:"文件备注","label-style":{whiteSpace:"nowrap"}},{default:n(()=>[r(a(T),{direction:"vertical",align:"end"},{default:n(()=>[r(a(j).TextArea,{value:p.value,"onUpdate:value":s[0]||(s[0]=e=>p.value=e),disabled:!o.$auth("netdisk:manage:mark"),placeholder:"请输入文件备注",maxlength:100,rows:4,"show-count":""},null,8,["value","disabled"]),r(v,{loading:k.value,disabled:!o.$auth("netdisk:manage:mark"),type:"primary",size:"mini",onClick:A},{default:n(()=>s[1]||(s[1]=[x("更新 ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1})]}),_:1})]),_:1},8,["spinning"])]),_:1},8,["visible"])}}});export{ae as _};
