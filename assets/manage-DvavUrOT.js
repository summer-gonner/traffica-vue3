import{r as m,b as P,dr as c,c as l,e7 as B,A as Y,d as X,az as Z,w as ee,o as ae,n as d,B as S,E as i,F as n,G as H,q as I,Q as te,K as ne,cN as le,H as O,L as oe,aY as $,aj as se}from"./index-B8Pm80oX.js";import{_ as ie,g as re}from"./file-operate-button-list.vue_vue_type_script_setup_true_lang-Dd47_Cp9.js";import{_ as me}from"./file-preview-drawer.vue_vue_type_script_setup_true_lang-DnfiYw-C.js";import{f as ue,p as pe}from"./index-CIQauGJF.js";import{f as ce}from"./dateUtil-E1W9AnjJ.js";import"./index.vue_vue_type_style_index_0_lang-CFuk3e67.js";import{u as fe}from"./useFormModal-CmrBxBAu.js";import{c as de}from"./createContextMenu-DoN2TjHH.js";import{u as ve}from"./dynamic-table-D22kRkZE.js";import"./ApiSelect.vue_vue_type_script_setup_true_lang-CofY2-NC.js";import"./dayjs.min-TeQhONF1.js";import{S as U}from"./index-CfT4fuvs.js";import{F as ge}from"./index-iNKLbYy_.js";import{B as F}from"./index-25wnLe6x.js";import{b as N}from"./index-B7GNZFXE.js";import{C as he}from"./index-INlSDQaG.js";import"./file-upload-drawer.vue_vue_type_script_setup_true_lang-BCFS9Tz_.js";import"./index-DhL-eOiI.js";import"./index-BT78Vb1q.js";import"./cloneDeep-lQkziu_-.js";import"./useFlexGapSupport-DLL49fC4.js";import"./hasIn-D18GTBYl.js";import"./_arrayIncludesWith-DbV0gfeD.js";import"./debounce-TsE9rPWj.js";import"./QuestionCircleOutlined-DwMKnzgY.js";import"./collapseMotion-Dg6yIgr5.js";import"./_castArrayLikeObject-DUjGHYOU.js";import"./index-BRG9fhiq.js";import"./CheckOutlined-D9pyqrzu.js";import"./useRefs-QkKGnXKa.js";import"./useMergedState-Cz6_zboM.js";import"./index-P37OXH9W.js";import"./isNumeric-DjvBa-1E.js";import"./index-CWarxRuf.js";import"./index-CND5kIK4.js";import"./_baseUniq-kMXtQ-ld.js";import"./move-B3QdINpa.js";import"./RightOutlined-BsZy0Phy.js";import"./CopyOutlined-D95pQ5l8.js";import"./index-CfCbjZdA.js";import"./isNumber-BQFvOqOr.js";import"./LeftOutlined-BKTs5glU.js";import"./index-Bp1gl4D3.js";import"./is-BPG7p_4t.js";import"./FullscreenOutlined-BZ3QrFwa.js";import"./useModal-ClPC9oek.js";import"./schema-form.vue_vue_type_script_setup_true_lang-CqVOkWCm.js";import"./index-7VmM7i5b.js";import"./DownOutlined-BRycSuUV.js";import"./pick-yPjmipd3.js";import"./VerticalRightOutlined-C0b_NAnm.js";import"./zh_CN-CAyhejr6.js";import"./index-g76Nm4Kx.js";import"./isMobile-BbN7I0i_.js";import"./index-Qnpm0yEw.js";import"./index-B4w1aCCw.js";import"./EnterOutlined-BnZ699CI.js";import"./index-kU5KwxBj.js";import"./PlusOutlined-6eP1e5F5.js";const ye=p=>p?ue(p):"-",ke=()=>{const p=m([]),v=m(""),k=P(()=>!c(v.value)),T=P(()=>[{title:"文件名",dataIndex:"name",align:"left"},{title:"大小",width:120,align:"center",dataIndex:"fsize",customRender:({record:a})=>l("span",null,[ye(a.fsize)])},{title:"上传时间",dataIndex:"putTime",align:"center",width:220,customRender({text:a}){return a?ce(a):"-"}},{title:"所属目录",dataIndex:"belongTo",align:"center",width:220,hideInTable:!k.value,customRender:({record:a})=>l(Y("a-button"),{type:"link",disabled:a.type==="file"&&B("netdisk:manage:info"),onClick:()=>C(a)},{default:()=>[a.belongTo?a.belongTo:"根目录"]})}]),C=a=>{v.value="",c(a.belongTo)?p.value=[]:p.value=a.belongTo.split("/")};return{columns:T,currentPathList:p,localSearchKey:v,isSearching:k}},be=["innerHTML"],_e={key:1},La=X({name:"NetDiskManage",__name:"manage",setup(p){const[v,k]=ve(),[T]=fe(),{columns:C,currentPathList:a,localSearchKey:u,isSearching:b}=ke(),w=m(),g=m([]),h=m(""),K=m(!1),D=m(!1),x=m(!1),f=m(!1),M=m([]),z=Z({selectedRowKeys:[],onChange:(e,t)=>{console.log("selectedRowKeys changed: ",e),z.selectedRowKeys=e,M.value=t.map(r=>({type:r.type,name:r.name}))}}),V=P(()=>c(h.value)),y=()=>{let e="";return a.value.length>0&&(e=`${a.value.join("/")}/`),e},j=(e,t)=>t==="dir"?"file-type-dir":pe(e),A=e=>e.replace(new RegExp(`${u.value}`,"g"),`<span style='color: red;'>${u.value}</span>`),J=e=>{K.value!==e&&(K.value=e)},L=()=>{h.value=" ",g.value=[],M.value=[],f.value&&(f.value=!1),R()},R=async()=>{var r;if(console.log("loadData lock.value",f.value),f.value)return;D.value=!0,f.value=!0;const e=y(),t=await $.netDiskManage.netDiskManageList({path:e,key:u.value,marker:((r=h.value)==null?void 0:r.trim())||""}).finally(()=>D.value=!1);if(c(h))g.value=t.list||[];else{const o=t.list.filter(s=>s.type==="file"?!0:!g.value.find(_=>_.type==="file"?!1:_.name===s.name));c(o)||g.value.push(...o)}h.value=t.marker,f.value=!1},E=e=>{console.log("handleJumpPath ",e),!b.value&&(e===-1&&a.value.length>0?a.value=[]:e>=0&&a.value.length-1!==e&&(a.value=a.value.slice(0,e+1)))},q=e=>{var t,r;if(console.log("handleClickFileItem ",e),e.type==="dir")if(b.value){const o=c(e.belongTo)?[]:e.belongTo.split("/");o.push(e.name),u.value="",a.value=o}else a.value.push(e.name);else b.value?(t=w.value)==null||t.open(e.name,c(e.belongTo)?"":`${e.belongTo}/`):(r=w.value)==null||r.open(e.name,y())},G=async e=>{try{x.value=!0;const t=await $.netDiskManage.netDiskManageDownload({path:y(),name:e.name});window.open(`${t}?attname=${encodeURIComponent(e.name)}`)}finally{x.value=!1}},Q=async e=>{console.log("record",e),await T({modalProps:{title:"重命名",width:700,onFinish:async t=>{await $.netDiskManage.netDiskManageRename({type:e.type,toName:t.toName,name:e.name,path:y()},{successMsg:"修改成功"}),L()}},formProps:{labelWidth:100,schemas:re(e)}})},W=e=>({onContextmenu:t=>{de({event:t,items:[{label:"下载",disabled:e.type==="dir"||!B("netdisk:manage:download"),handler:()=>{G(e)}},{label:"重命名",disabled:!B("netdisk:manage:rename"),handler:()=>{Q(e)}}]})}});return ee([a,u],()=>{L()},{deep:!0}),ae(()=>{R(),k.onInfiniteScroll(()=>{V.value||R()})}),(e,t)=>{const r=se;return d(),S(n(he),{class:"h-full"},{title:i(()=>[l(n(U),null,{default:i(()=>[l(n(ge)),l(n(F),null,{default:i(()=>[l(n(F).Item,null,{default:i(()=>[l(n(N).Link,{onClick:t[0]||(t[0]=o=>E(-1))},{default:i(()=>t[2]||(t[2]=[H("根目录")])),_:1})]),_:1}),(d(!0),I(ne,null,te(n(a),(o,s)=>(d(),S(n(F).Item,{key:s},{default:i(()=>[l(n(N).Link,{onClick:_=>E(s)},{default:i(()=>[H(O(o),1)]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]),_:1})]),extra:i(()=>[l(ie,{"search-key":n(u),"onUpdate:searchKey":t[1]||(t[1]=o=>le(u)?u.value=o:null),"selected-file-list":M.value,"update-operate-status":J,"parse-path":y,onChanged:L},null,8,["search-key","selected-file-list"])]),default:i(()=>[l(n(v),{"data-source":g.value,columns:n(C),"custom-row":W,"auto-height":!0,pagination:!1,search:!1,"show-tool-bar":!1,loading:D.value,"row-selection":z},{bodyCell:i(({column:o,record:s})=>[o.key==="name"?(d(),S(n(N).Link,{key:0,disabled:s.type==="file"&&e.$auth("netdisk:manage:info"),onClick:_=>q(s)},{default:i(()=>[l(n(U),null,{default:i(()=>[l(r,{name:j(s.name,s.type)},null,8,["name"]),n(b)?(d(),I("span",{key:0,innerHTML:A(s.name)},null,8,be)):(d(),I("span",_e,O(s.name),1))]),_:2},1024)]),_:2},1032,["disabled","onClick"])):oe("",!0)]),_:1},8,["data-source","columns","loading","row-selection"]),l(me,{ref_key:"previewDrawerRef",ref:w},null,512)]),_:1})}}});export{La as default};
