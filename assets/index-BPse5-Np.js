import{d as j,bE as N,eh as O,ei as B,aC as D,ej as S,r as w,b as F,a2 as G,n as v,B as P,E as m,c as r,q as T,K as z,Q as K,F as c,ek as L,a1 as U,el as M,Y as W,ak as H,a9 as Y,dW as Q,aE as X,k as J,X as k,aT as Z,G as b,aY as y,dB as R,em as ee,e4 as te,y as ne,A as oe,aU as ae}from"./index-B8Pm80oX.js";import{f as se}from"./dateUtil-E1W9AnjJ.js";import{T as h}from"./index-Qnpm0yEw.js";import{_ as ie,T as le}from"./index-kU5KwxBj.js";import"./index-BT78Vb1q.js";import{f as re,s as A}from"./common-I8s7oTzl.js";import{u as pe}from"./dynamic-table-D22kRkZE.js";import"./ApiSelect.vue_vue_type_script_setup_true_lang-CofY2-NC.js";import"./dayjs.min-TeQhONF1.js";import"./index.vue_vue_type_style_index_0_lang-CFuk3e67.js";import{u as ue}from"./useFormModal-CmrBxBAu.js";import"./index-CND5kIK4.js";import"./_baseUniq-kMXtQ-ld.js";import"./_arrayIncludesWith-DbV0gfeD.js";import"./collapseMotion-Dg6yIgr5.js";import"./useRefs-QkKGnXKa.js";import"./pick-yPjmipd3.js";import"./hasIn-D18GTBYl.js";import"./isMobile-BbN7I0i_.js";import"./useMergedState-Cz6_zboM.js";import"./PlusOutlined-6eP1e5F5.js";import"./cloneDeep-lQkziu_-.js";import"./useFlexGapSupport-DLL49fC4.js";import"./debounce-TsE9rPWj.js";import"./QuestionCircleOutlined-DwMKnzgY.js";import"./_castArrayLikeObject-DUjGHYOU.js";import"./index-CWarxRuf.js";import"./move-B3QdINpa.js";import"./RightOutlined-BsZy0Phy.js";import"./VerticalRightOutlined-C0b_NAnm.js";import"./schema-form.vue_vue_type_script_setup_true_lang-CqVOkWCm.js";import"./isNumber-BQFvOqOr.js";import"./is-BPG7p_4t.js";import"./index-7VmM7i5b.js";import"./DownOutlined-BRycSuUV.js";import"./index-CIQauGJF.js";import"./FullscreenOutlined-BZ3QrFwa.js";import"./index-CfT4fuvs.js";import"./LeftOutlined-BKTs5glU.js";import"./zh_CN-CAyhejr6.js";import"./index-iNKLbYy_.js";import"./index-B7GNZFXE.js";import"./EnterOutlined-BnZ699CI.js";import"./CheckOutlined-D9pyqrzu.js";import"./CopyOutlined-D95pQ5l8.js";import"./index-g76Nm4Kx.js";import"./index-DhL-eOiI.js";import"./index-BRG9fhiq.js";import"./index-B4w1aCCw.js";import"./useModal-ClPC9oek.js";const me=["title","onClick"],ce=j({inheritAttrs:!1,__name:"IconPicker",props:N(O,{value:{},valueModifiers:{}}),emits:["update:value"],setup(e){B();const l=D(e,"value"),o=Object.entries(S).reduce((t,[s,i])=>(t[s]=Object.keys(i.icons).map(g=>({name:`${i.prefix}:${g}`})),t),{全部:Object.values(S).flatMap(t=>Object.keys(t.icons).map(s=>({name:`${t.prefix}:${s}`})))}),p=w(!1),a=w("全部"),d=w(""),I=F(()=>o[a.value].filter(s=>s.name.includes(d.value))),_=G(t=>{d.value=t.target.value},100),n=t=>{l.value=t,p.value=!1};return(t,s)=>{const i=ie,g=le,C=Y,E=Q,q=X;return v(),P(q,null,{default:m(()=>[r(E,{open:p.value,"onUpdate:open":s[2]||(s[2]=u=>p.value=u),placement:"bottomLeft","overlay-inner-style":{paddingTop:0},trigger:"click"},{title:m(()=>[r(g,{activeKey:a.value,"onUpdate:activeKey":s[0]||(s[0]=u=>a.value=u),size:"small","tab-bar-style":{marginBottom:"8px"}},{default:m(()=>[(v(!0),T(z,null,K(c(o),(u,x)=>(v(),P(i,{key:x,tab:x},null,8,["tab"]))),128))]),_:1},8,["activeKey"]),r(C,{autofocus:"","allow-clear":"",placeholder:`从“${a.value}”中搜索图标`,onChange:c(_)},null,8,["placeholder","onChange"])]),content:m(()=>[r(c(L),{class:"select-box",items:I.value,"key-field":"name","item-size":38,"grid-items":9,"item-secondary-size":38},{default:m(({item:u})=>[(v(),T("div",{key:u.name,title:u.name,class:U([{active:l.value==u.name},"select-box-item"]),onClick:x=>n(u.name)},[r(c(M),{icon:u.name,class:"text-[20px]"},null,8,["icon"])],10,me))]),_:1},8,["items"])]),default:m(()=>[r(C,W(t.$attrs,{value:l.value,"onUpdate:value":s[1]||(s[1]=u=>l.value=u),placeholder:t.placeholder,"allow-clear":""}),H({_:2},[l.value?{name:"prefix",fn:m(()=>[r(c(M),{icon:l.value,class:"text-[20px]"},null,8,["icon"])]),key:"0"}:void 0]),1040,["value","placeholder"])]),_:1},8,["open"])]),_:1})}}}),de=J(ce,[["__scopeId","data-v-97180474"]]);function V(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Z(e)}const fe=e=>{switch(e){case 0:return r(h,{color:"warning"},{default:()=>[b("目录")]});case 1:return r(h,{color:"success"},{default:()=>[b("菜单")]});case 2:return r(h,{color:"error"},{default:()=>[b("按钮")]});default:return""}},ye=[{title:"名称",dataIndex:"menuName",align:"left",fixed:"left",width:200},{title:"图标",width:40,dataIndex:"menuIcon",hideInSearch:!0,customRender:({record:e})=>e.menuIcon&&r(k,{icon:e.menuIcon,size:"22"},null)},{title:"类型",width:80,dataIndex:"menuType",hideInSearch:!0,customRender:({record:e})=>fe(e.menuType)},{title:"节点路由",dataIndex:"menuPath",width:180,ellipsis:!0},{title:"文件路径",width:180,dataIndex:"vueComponent"},{title:"权限标识",width:180,dataIndex:"permission",hideInSearch:!0,customRender:({record:e})=>e.menuPerms&&r(h,{color:"processing"},{default:()=>[e.menuPerms]})},{title:"排序",width:50,dataIndex:"menuSort",hideInSearch:!0},{title:"路由缓存",dataIndex:"keepalive",width:80,hideInSearch:!0,customRender:({record:e})=>e.menuStatus===1&&(e.keepAlive?"是":"否")},{title:"是否显示",dataIndex:"isVisible",width:80,hideInSearch:!0,customRender:({record:e})=>{const o=~~e.isVisible===1,p=o?"green":"red",a=o?"显示":"隐藏";return r(h,{color:p},V(a)?a:{default:()=>[a]})}},{title:"状态",dataIndex:"menuStatus",width:80,hideInSearch:!0,customRender:({record:e})=>{const o=~~e.menuStatus===1,p=o?"green":"red",a=o?"启用":"停用";return r(h,{color:p},V(a)?a:{default:()=>[a]})}},{title:"更新时间",width:180,dataIndex:"updateTime",hideInSearch:!0,customRender({text:e}){return e.updateTime===""?"":se(e.updateTime)}}],be=e=>e===0,$=e=>e===1,f=e=>e===2,he=()=>[{field:"type",component:"RadioGroup",label:"菜单类型",defaultValue:0,rules:[{required:!0,type:"number"}],componentProps:{options:[{label:"目录",value:0},{label:"菜单",value:1},{label:"权限",value:2}]}},{field:"menuName",component:"Input",label:({formModel:e})=>f(e.type)?"权限名称":"节点名称",rules:[{required:!0,type:"string"}]},{field:"parentId",component:"TreeSelect",label:"上级节点",componentProps:{fieldNames:{label:"name",value:"id"},request:async({schema:e,formModel:l})=>{const o=await y.systemMenu.menuList({}),p=[-1].concat(re(o,l.parentId)||[]);return e.value.componentProps.treeDefaultExpandedKeys=p,[{id:-1,name:"根目录",children:o}]},getPopupContainer:()=>document.body},rules:[{required:!0,type:"number"}]},{field:"path",component:"Input",label:"路由地址",vIf:({formModel:e})=>!f(e.type),rules:[{required:!0,type:"string"}]},{field:"permission",component:"Input",label:"权限",helpMessage:"对应控制器中定义的权限字符，如：@Perm('system:menu:list'))",vIf:({formModel:e})=>!be(e.type),required:({formModel:e})=>f(e.type),afterSlot:({schema:e,formInstance:l,formModel:o})=>e.value.component==="Input"?R(k,{icon:"ant-design:folder-open-outlined",title:"选择权限",class:"ml-[12px] cursor-pointer",onclick:async()=>{const p=await y.systemMenu.menuGetPermissions();typeof o.permission=="string"&&(o.permission=o.permission.split(":")),l.updateSchema({field:"permission",component:"Cascader",componentProps:{displayRender:({labels:a})=>a.join(":"),options:p.reduce((a,d)=>(A(d,a,":"),a),[])}})}}):R(k,{icon:"ant-design:edit-outlined",title:"手动输入",class:"ml-[12px] cursor-pointer",onclick:()=>{Array.isArray(o.permission)&&(o.permission=o.permission.join(":")),l.updateSchema({field:"permission",component:"Input"})}})},{field:"component",component:"Cascader",label:"文件路径",vIf:({formModel:e})=>$(e.type)&&!e.isExt,componentProps:{options:Object.keys(ee).reduce((e,l)=>(A(l,e,"/"),e),[])},rules:[{required:!0,type:"array"}]},{field:"icon",component:()=>de,label:"节点图标",vIf:({formModel:e})=>!f(e.type)},{field:"orderNo",component:"InputNumber",label:"排序号",defaultValue:255,componentProps:{style:{width:"100%"}}},{field:"isExt",component:"RadioGroup",label:"是否外链",defaultValue:!1,helpMessage:"选择是外链则路由地址需要以`http(s)://`开头",colProps:{span:12},componentProps:{optionType:"button",buttonStyle:"solid",options:[{label:"是",value:!0},{label:"否",value:!1}]},vIf:({formModel:e})=>!f(e.type)},{field:"extOpenMode",component:"RadioGroup",label:"打开方式",defaultValue:1,vIf:({formModel:e})=>!f(e.type)&&e.isExt,colProps:{span:12},componentProps:{optionType:"button",buttonStyle:"solid",options:[{label:"新窗口打开",value:1},{label:"内嵌页打开",value:2}]}},{field:"keepAlive",component:"RadioGroup",label:"是否缓存",defaultValue:0,vIf:({formModel:e})=>$(e.type),colProps:{span:12},componentProps:{optionType:"button",buttonStyle:"solid",options:[{label:"是",value:1},{label:"否",value:0}]}},{field:"show",component:"RadioGroup",label:"是否显示",defaultValue:1,colProps:{span:12},helpMessage:"会生成路由,但左侧菜单不可见",componentProps:{optionType:"button",buttonStyle:"solid",options:[{label:"是",value:1},{label:"否",value:0}]},vIf:({formModel:e})=>!f(e.type)},{field:"activeMenu",component:"Input",label:"高亮菜单项",colProps:{span:12},helpMessage:"值为某个的节点的路由地址(可设置当前路由高亮的菜单项，多用于详情页)",componentProps:{placeholder:"需要高亮的菜单项(节点名称)"},vIf:({formModel:e})=>!e.show&&!f(e.type)},{field:"status",label:"状态",component:"RadioGroup",defaultValue:1,helpMessage:"不会生成路由,同时左侧菜单不可见",componentProps:{optionType:"button",buttonStyle:"solid",options:[{label:"启用",value:1},{label:"禁用",value:0}]}}],ve={class:"flex gap-2 ml-2"},yt=j({name:"SysMenu",__name:"index",setup(e){const[l,o]=pe({pagination:!1,size:"small",rowKey:"id",bordered:!0,autoHeight:!0}),[p]=ue(),a=ae();te(document.documentElement,()=>{var t;const n=(t=a==null?void 0:a.proxy)==null?void 0:t.$el;n&&o.setProps({scroll:{x:window.innerWidth>2e3?n.offsetWidth-20:2e3}})});const d=async n=>{var s;const[t]=await p({modalProps:{title:`${n.id?"编辑":"新增"}菜单`,width:700,onFinish:async i=>{console.log("新增/编辑菜单",i),n.id&&(i.menuId=n.id),Array.isArray(i.component)&&(i.component=i.component.join("/")),Array.isArray(i.permission)&&(i.permission=i.permission.join(":")),i.parentId===-1&&Reflect.deleteProperty(i,"parentId"),n.id?await y.systemMenu.menuUpdate({id:n.id},i):await y.systemMenu.menuCreate(i),o.reload()}},formProps:{labelWidth:100,schemas:he()}});t==null||t.setFieldsValue({...n,icon:n.menuIcon??"",parentId:n.parentId??-1,component:(s=n.vueComponent)==null?void 0:s.split("/")}),console.log("record",n)},I=async n=>{await y.systemMenu.menuDelete({id:n.id}),o.reload()},_=[...ye,{title:"操作",width:160,dataIndex:"ACTION",hideInSearch:!0,fixed:"right",actions:({record:n})=>[{label:"编辑",auth:{perm:"system:menu:update",effect:"disable"},onClick:()=>d(n)},{label:"新增",auth:{perm:"system:menu:create",effect:"disable"},disabled:n.menuType===2||n.menuStatus===0,onClick:()=>d({parentId:n.id})},{label:"删除",auth:"system:menu:delete",popConfirm:{title:"你确定要删除吗？",placement:"left",onConfirm:()=>I(n)}}]}];return(n,t)=>{const s=oe("a-button");return v(),P(c(l),{"header-title":"菜单管理","data-request":c(y).systemMenu.menuList,columns:_},{afterHeaderTitle:m(()=>[ne("div",ve,[r(s,{onClick:c(o).expandAll},{default:m(()=>t[1]||(t[1]=[b("展开全部")])),_:1},8,["onClick"]),r(s,{onClick:c(o).collapseAll},{default:m(()=>t[2]||(t[2]=[b("折叠全部")])),_:1},8,["onClick"])])]),toolbar:m(()=>[r(s,{type:"primary",disabled:!n.$auth("system:menu:create"),onClick:t[0]||(t[0]=i=>d({}))},{default:m(()=>t[3]||(t[3]=[b(" 新增 ")])),_:1},8,["disabled"])]),_:1},8,["data-request"])}}});export{yt as default};
